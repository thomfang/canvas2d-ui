{"version":3,"file":null,"sources":["../src/Utility.ts","../src/Request.ts","../src/Observer.ts","../src/ObservableArray.ts","../src/Observable.ts","../src/ObservableObject.ts","../src/ExpParser.ts","../src/TemplateParser.ts","../src/TemplateManager.ts","../src/StyleManager.ts","../src/ViewManager.ts","../src/Watcher.ts","../src/WatcherManager.ts","../src/BindingManager.ts","../src/ComponentManager.ts","../src/PathToRegexp.ts","../src/Loader.ts","../src/Application.ts","../src/TouchScroll.ts","../src/InternalViews.ts","../src/ScrollView.ts","../src/AutoLayoutView.ts","../src/AutoResizeView.ts","../src/WeakRef.ts","../src/InternalDirectives.ts"],"sourcesContent":["\r\nvar uidCounter: number = 0;\r\nvar uniqueSymbol = `canvas2d.uid.${Date.now()}`;\r\n// var reFileName = /(\\w+)\\.\\w+$/;\r\nvar reFilePath = /(.+)\\.\\w+$/;\r\n\r\nexport class Utility {\r\n\r\n    private static UID_OF_NAN: number;\r\n    private static UID_OF_NULL: number;\r\n    private static UID_OF_TRUE: number;\r\n    private static UID_OF_FALSE: number;\r\n    private static UID_OF_UNDEFINED: number;\r\n    private static isUidInited: boolean;\r\n\r\n    public static log(...args: any[]) {\r\n        console.log(\"[canvas2dUI]\", ...args);\r\n    }\r\n\r\n    public static error(...args: any[]): any {\r\n        console.error(\"[canvas2dUI]\", ...args);\r\n    }\r\n\r\n    public static warn(...args: any[]): any {\r\n        console.warn(\"[canvas2dUI]\", ...args);\r\n    }\r\n\r\n    public static getUid(target): number {\r\n        if (!this.isUidInited) {\r\n            this.UID_OF_FALSE = this.getObjectUid({});\r\n            this.UID_OF_NAN = this.getObjectUid({});\r\n            this.UID_OF_NULL = this.getObjectUid({});\r\n            this.UID_OF_TRUE = this.getObjectUid({});\r\n            this.UID_OF_UNDEFINED = this.getObjectUid({});\r\n            this.isUidInited = true;\r\n        }\r\n        if (target === null) {\r\n            return this.UID_OF_NULL;\r\n        }\r\n        if (target === undefined) {\r\n            return this.UID_OF_UNDEFINED;\r\n        }\r\n        if (target === true) {\r\n            return this.UID_OF_TRUE;\r\n        }\r\n        if (target === false) {\r\n            return this.UID_OF_FALSE;\r\n        }\r\n\r\n        let type = typeof target;\r\n\r\n        if (type === 'object' || type === 'function') {\r\n            return this.getObjectUid(target);\r\n        }\r\n        if (type === 'string') {\r\n            return <any>('\"' + target + '\"');\r\n        }\r\n        if (type === 'number') {\r\n            if (isNaN(target)) {\r\n                return this.UID_OF_NAN;\r\n            }\r\n            return <any>('-' + target + '-');\r\n        }\r\n        this.error(`Unknow type of target`, target);\r\n    }\r\n\r\n    private static getObjectUid(target) {\r\n        if (typeof target[uniqueSymbol] === 'undefined') {\r\n            Object.defineProperty(target, uniqueSymbol, {\r\n                value: uidCounter++\r\n            });\r\n        }\r\n        return target[uniqueSymbol];\r\n    }\r\n\r\n    public static isNewValueAnObjectOrNotEqualOldValue(a, b) {\r\n        return a !== b || (typeof a === 'object' && a);\r\n    }\r\n\r\n    public static isPlainObjectOrObservableObject(target: any): boolean {\r\n        if (!target || typeof target !== 'object') {\r\n            return false;\r\n        }\r\n\r\n        let prototype = Object.getPrototypeOf(target);\r\n        let isObjectType = Object.prototype.toString.call(target) === '[object Object]';\r\n        let isRawObject = prototype === Object.prototype;\r\n\r\n        return isObjectType && isRawObject;\r\n    }\r\n\r\n    public static removeItemFromArray(item, arr: any[]) {\r\n        let index = arr.indexOf(item);\r\n        if (index > -1) {\r\n            arr.splice(index, 1);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public static addEnsureUniqueArrayItem(item, arr: any[]) {\r\n        let index = arr.indexOf(item);\r\n        if (index < 0) {\r\n            arr.push(item);\r\n            return true;\r\n        }\r\n        return false\r\n    }\r\n\r\n    public static createProxy(target: object, property: string, source: object) {\r\n        if (this.hasProxy(target, property)) {\r\n            return false;\r\n        }\r\n\r\n        function proxyGetterSetter(...args: any[]) {\r\n            if (args.length === 0) {\r\n                return source[property];\r\n            }\r\n            source[property] = args[0];\r\n        }\r\n\r\n        Object.defineProperty(target, property, {\r\n            enumerable: true,\r\n            configurable: true,\r\n            set: proxyGetterSetter,\r\n            get: proxyGetterSetter\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    public static hasProxy(target: any, property: string) {\r\n        var des = Object.getOwnPropertyDescriptor(target, property);\r\n        if (des && ((typeof des.get === 'function' && des.get === des.set) || !des.configurable)) {\r\n            return true;\r\n        }\r\n\r\n        var proto = target.__proto__;\r\n        while (proto) {\r\n            des = Object.getOwnPropertyDescriptor(proto, property);\r\n            if (des && ((typeof des.get === 'function' && des.get === des.set) || !des.configurable)) {\r\n                Object.defineProperty(target, property, des);\r\n                return true;\r\n            }\r\n            proto = proto.__proto__;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public static deepClone(target) {\r\n        if (target && typeof target === 'object') {\r\n            if (Array.isArray(target)) {\r\n                let newArr = [];\r\n                for (let i = 0, l = target.length; i < l; i++) {\r\n                    let item = target[i];\r\n                    newArr[i] = this.deepClone(item);\r\n                }\r\n                return newArr;\r\n            }\r\n            let ret = {};\r\n            for (let name in target) {\r\n                ret[name] = this.deepClone(target[name]);\r\n            }\r\n            return ret;\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    public static queryStringToObject(str: string) {\r\n        let ret: { [key: string]: any } = {};\r\n        let list = str.split('&');\r\n        for (let i = 0, l = list.length; i < l; i++) {\r\n            let [key, value] = list[i].split('=');\r\n            value = decodeURIComponent(value);\r\n\r\n            if (ret[key] != null) {\r\n                if (!Array.isArray(ret[key])) {\r\n                    ret[key] = [ret[key]];\r\n                }\r\n                ret[key].push(value);\r\n            }\r\n            else {\r\n                ret[key] = value;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    public static objToQueryString(obj: Object) {\r\n        return Object.keys(obj).map(key => {\r\n            let value = obj[key];\r\n            if (Array.isArray(value)) {\r\n                return value.map(v => key + '=' + encodeURIComponent(v));\r\n            }\r\n            return key + '=' + encodeURIComponent(value)\r\n        }).join('&');\r\n    }\r\n\r\n    public static getFilePath(path: string) {\r\n        let res = path.match(reFilePath);\r\n        return res && res[1];\r\n    }\r\n\r\n    private static nextTickCallbacks: { callback: Function, thisObject: any }[] = [];\r\n    private static nextTickHandle: number;\r\n\r\n    public static nextTick(callback: Function, thisObject?) {\r\n        for (let i = 0, l = this.nextTickCallbacks.length; i < l; i++) {\r\n            let context = this.nextTickCallbacks[i];\r\n            if (context.callback === callback && context.thisObject === thisObject) {\r\n                return null;\r\n            }\r\n        }\r\n        this.nextTickCallbacks.push({\r\n            callback,\r\n            thisObject,\r\n        });\r\n        if (this.nextTickHandle == null) {\r\n            this.nextTickHandle = (window.requestAnimationFrame || setTimeout)(() => {\r\n                this.nextTickHandle = null;\r\n                let callbacks = this.nextTickCallbacks.slice();\r\n                this.nextTickCallbacks.length = 0;\r\n                for (let i = 0, l = callbacks.length; i < l; i++) {\r\n                    let context = callbacks[i];\r\n                    context.callback.call(context.thisObject);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}","import { Utility } from './Utility';\r\n\r\nconst schemeRegex = /^(\\w+)\\:\\/\\//;\r\n\r\nexport class Request {\r\n\r\n    public static xhr<T>(options: XHROptions, onSuccess?: (res) => T, onError?: (err) => any, onComplete?: Function) {\r\n        var xhr = new XMLHttpRequest();\r\n\r\n        if (typeof options.url !== 'string' || !options.url) {\r\n            return Utility.error(`xhr(options): Invalid options.url.`);\r\n        }\r\n\r\n        let url = options.url;\r\n        let type = (options.method || 'GET').toUpperCase();\r\n        let headers = options.headers || {};\r\n        let data: any = options.data;\r\n        let contentType: string = options.contentType;\r\n        let isLocalRequest = false;\r\n        let schemeMatch = schemeRegex.exec(options.url.toLowerCase());\r\n\r\n        if (schemeMatch) {\r\n            if (schemeMatch[1] === 'file') {\r\n                isLocalRequest = true;\r\n            }\r\n        }\r\n        else if (location.protocol === 'file:') {\r\n            isLocalRequest = true;\r\n        }\r\n\r\n        if (Object.prototype.toString.call(data) === '[object Object]') {\r\n            if (contentType && contentType.match(/json/i)) {\r\n                data = JSON.stringify(data);\r\n            }\r\n            else {\r\n                data = Utility.objToQueryString(data);\r\n\r\n                if (type === 'GET') {\r\n                    url += (url.indexOf('?') === -1 ? '?' : '&') + data;\r\n                    data = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                if ((xhr.status >= 200 && xhr.status < 300) || (isLocalRequest && xhr.status === 0)) {\r\n                    onSuccess && onSuccess(xhr.response);\r\n                }\r\n                else {\r\n                    let contentType = xhr.getResponseHeader('Content-Type');\r\n                    onError && onError({\r\n                        res: xhr.response,\r\n                        xhr: xhr\r\n                    });\r\n                    onError = null;\r\n                }\r\n                xhr = null;\r\n                onComplete && onComplete();\r\n            }\r\n        };\r\n\r\n        xhr.onerror = () => {\r\n            onError && onError({\r\n                res: xhr.response,\r\n                xhr: xhr\r\n            });\r\n            onError = xhr = null;\r\n        }\r\n\r\n        xhr.open(type, url, true, options.user, options.password);\r\n\r\n        if (options.withCredentials) {\r\n            xhr.withCredentials = true;\r\n        }\r\n        if (options.responseType) {\r\n            xhr.responseType = options.responseType as any;\r\n        }\r\n\r\n        if (typeof options.timeout === 'number' && options.timeout > 0) {\r\n            xhr.timeout = options.timeout;\r\n            xhr.ontimeout = () => {\r\n                if (xhr) {\r\n                    xhr.abort();\r\n                    onError && onError({ res: { message: \"Timeout\" }, xhr });\r\n                    xhr = null;\r\n                    onComplete && onComplete();\r\n                }\r\n            };\r\n        }\r\n        if (contentType) {\r\n            xhr.setRequestHeader(\"Content-Type\", contentType);\r\n        }\r\n\r\n        for (let name in headers) {\r\n            xhr.setRequestHeader(name, headers[name]);\r\n        }\r\n\r\n        xhr.send(data);\r\n    }\r\n\r\n    public static get<T>(url: string, onSuccess?: (res) => T, onError?: (err) => any, onComplete?: Function) {\r\n        this.xhr({ url }, onSuccess, onError, onComplete);\r\n    }\r\n\r\n    public static post<T>(url: string, data, onSuccess?: (res) => T, onError?: (err) => any, onComplete?: Function) {\r\n        this.xhr({ url, method: \"POST\", data, contentType: \"application/json\", }, onSuccess, onError, onComplete);\r\n    }\r\n\r\n    public static getJson<T>(url: string, onSuccess?: (res) => T, onError?: (err) => any, onComplete?: Function) {\r\n        this.xhr({ url, responseType: 'json' }, onSuccess, onError, onComplete);\r\n    }\r\n\r\n    public static postJson<T>(url: string, data, onSuccess?: (res) => T, onError?: (err) => any, onComplete?: Function) {\r\n        this.xhr({ url, method: \"POST\", data, responseType: 'json', contentType: \"application/json\" }, onSuccess, onError, onComplete);\r\n    }\r\n}\r\n\r\nexport type XHROptions = {\r\n    url: string;\r\n    method?: string;\r\n    data?: string | {};\r\n    headers?: { [key: string]: string };\r\n    withCredentials?: boolean;\r\n    contentType?: string;\r\n    responseType?: string;\r\n    timeout?: number;\r\n    user?: string;\r\n    password?: string;\r\n}\r\n","import { EventEmitter } from 'canvas2djs';\r\n\r\nexport class Observer extends EventEmitter {\r\n\r\n    private propertyChangedListeners: Function[] = [];\r\n\r\n    addPropertyChangedListener(listener: Function) {\r\n        if (this.propertyChangedListeners.indexOf(listener) < 0) {\r\n            this.propertyChangedListeners.push(listener);\r\n        }\r\n    }\r\n\r\n    removePropertyChangedListener(listener: Function) {\r\n        let index = this.propertyChangedListeners.indexOf(listener);\r\n        if (index > -1) {\r\n            this.propertyChangedListeners.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    emitPropertyChanged() {\r\n        let list = this.propertyChangedListeners.slice();\r\n        for (let listener: Function, i = 0; listener = list[i]; i++) {\r\n            listener();\r\n        }\r\n    }\r\n}","import { Observable } from './Observable';\r\nimport { Utility } from './Utility';\r\n\r\nexport class ObservableArray {\r\n\r\n    public static extendedPrototype = Object.create(Array.prototype, {\r\n\r\n        pop: {\r\n            value: function pop() {\r\n                let result = Array.prototype.pop.call(this);\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        shift: {\r\n            value: function shift() {\r\n                let result = Array.prototype.shift.call(this);\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        push: {\r\n            value: function push(...args: any[]) {\r\n                let result = Array.prototype.push.apply(this, args);\r\n                for (let i = 0, l = args.length; i < l; i++) {\r\n                    Observable.makeObservable(args[i]);\r\n                }\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        unshift: {\r\n            value: function unshift(...args: any[]) {\r\n                let result = Array.prototype.unshift.apply(this, args);\r\n                for (let i = 0, l = args.length; i < l; i++) {\r\n                    Observable.makeObservable(args[i]);\r\n                }\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        splice: {\r\n            value: function splice(...args: any[]) {\r\n                let result = Array.prototype.splice.apply(this, args);\r\n                let list = args.slice(2);\r\n                for (let i = 0, l = list.length; i < l; i++) {\r\n                    Observable.makeObservable(list[i]);\r\n                }\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        sort: {\r\n            value: function sort(callback?: (a: any, b: any) => any[]) {\r\n                let result = Array.prototype.sort.call(this, callback);\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        },\r\n\r\n        reverse: {\r\n            value: function reverse() {\r\n                let result = Array.prototype.reverse.call(this);\r\n                Observable.notifyChanged(this);\r\n                return result;\r\n            }\r\n        }\r\n    });\r\n\r\n    public static setAt<T>(array: Array<T>, index: number, value: T): void {\r\n        if (index > array.length) {\r\n            array.length = index + 1;\r\n        }\r\n\r\n        array.splice(index, 1, value);\r\n    }\r\n\r\n    public static removeAt<T>(array: Array<T>, index: number): T {\r\n        let result: T;\r\n\r\n        if (index > -1 && index < array.length) {\r\n            result = Array.prototype.splice.call(array, index, 1)[0];\r\n\r\n            Observable.notifyChanged(array);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public static removeByItem<T>(array: Array<T>, value: any): void {\r\n        Utility.removeItemFromArray(value, array);\r\n    }\r\n\r\n    public static removeAllByItem<T>(array: Array<T>, value: any): void {\r\n        var matchedIndexList: number[] = [];\r\n        var step = 0;\r\n\r\n        for (let index = 0, l = array.length; index < l; index++) {\r\n            let item = array[index];\r\n            if (value === item) {\r\n                matchedIndexList.push(index - step++);\r\n            }\r\n        }\r\n\r\n        if (matchedIndexList.length) {\r\n            for (let index = 0, l = matchedIndexList.length; index < l; index++) {\r\n                array.splice(index, 1);\r\n            }\r\n            Observable.notifyChanged(array);\r\n        }\r\n    }\r\n}","import { Observer } from './Observer';\r\nimport { Utility } from './Utility';\r\nimport { ObservableArray } from './ObservableArray';\r\n\r\nvar beforeAccessPropertyCallback: PropertyAccessCallback;\r\n\r\nexport class Observable {\r\n\r\n    public static setBeforeAccessPropertyCallback(callback: PropertyAccessCallback) {\r\n        beforeAccessPropertyCallback = callback;\r\n    }\r\n\r\n    public static observe(target, property: string, value: any): void {\r\n        if (typeof value === 'function') {\r\n            return;\r\n        }\r\n\r\n        let descriptor = Object.getOwnPropertyDescriptor(target, property);\r\n\r\n        if (descriptor && typeof descriptor.get === 'function' && descriptor.get === descriptor.set) {\r\n            return;\r\n        }\r\n\r\n        let targetObserver: Observer = Observable.makeObservable(target);\r\n        let valueObserver: Observer = Observable.makeObservable(value);\r\n\r\n        Object.defineProperty(target, property, {\r\n            enumerable: true,\r\n            configurable: true,\r\n            get: propertyGetterSetter,\r\n            set: propertyGetterSetter\r\n        });\r\n\r\n        if (valueObserver) {\r\n            valueObserver.addPropertyChangedListener(propertyChanged);\r\n        }\r\n\r\n        function propertyGetterSetter(...args: any[]) {\r\n            if (args.length === 0) {\r\n                if (typeof beforeAccessPropertyCallback === 'function') {\r\n                    beforeAccessPropertyCallback(targetObserver, property, value, target);\r\n                }\r\n\r\n                return value;\r\n            }\r\n\r\n            let newValue = args[0];\r\n\r\n            if (!Utility.isNewValueAnObjectOrNotEqualOldValue(newValue, value)) {\r\n                return;\r\n            }\r\n\r\n            if (valueObserver) {\r\n                valueObserver.removePropertyChangedListener(propertyChanged);\r\n            }\r\n\r\n            value = newValue;\r\n            valueObserver = Observable.makeObservable(newValue);\r\n\r\n            if (valueObserver) {\r\n                valueObserver.addPropertyChangedListener(propertyChanged);\r\n            }\r\n\r\n            propertyChanged();\r\n        }\r\n\r\n        function propertyChanged() {\r\n            targetObserver.emit(property);\r\n        }\r\n    }\r\n\r\n    public static makeObservable<T>(data): Observer {\r\n        let isObject = Utility.isPlainObjectOrObservableObject(data);\r\n\r\n        if (!isObject && !Array.isArray(data)) {\r\n            return;\r\n        }\r\n\r\n        let observer: Observer;\r\n\r\n        if (typeof data.__source__ !== 'undefined') {\r\n            return data.__source__.__observer__;\r\n        }\r\n\r\n        if (typeof data.__observer__ === 'undefined') {\r\n            observer = new Observer();\r\n\r\n            Object.defineProperties(data, {\r\n                __observer__: {\r\n                    value: observer,\r\n                    writable: true,\r\n                    configurable: true\r\n                }\r\n            });\r\n\r\n            if (isObject) {\r\n                for (let property in data) {\r\n                    Observable.observe(data, property, data[property]);\r\n                }\r\n            }\r\n            else {\r\n                data.__proto__ = ObservableArray.extendedPrototype;\r\n\r\n                for (let i = 0, l = data.length; i < l; i++) {\r\n                    let item = data[i];\r\n                    Observable.makeObservable(item);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            observer = data.__observer__;\r\n        }\r\n\r\n        return observer;\r\n    }\r\n\r\n    public static toObservable(object) {\r\n        this.makeObservable(object);\r\n        return object;\r\n    }\r\n\r\n    public static clear(object) {\r\n        if (object && object.__observer__ != null) {\r\n            delete object.__observer__;\r\n        }\r\n    }\r\n\r\n    public static notifyChanged<T>(data: object): void {\r\n        let observer: Observer = data['__observer__'];\r\n\r\n        if (observer) {\r\n            observer.emitPropertyChanged();\r\n        }\r\n    }\r\n}\r\n\r\nexport type PropertyAccessCallback = (observer: Observer, property: string, value: any, data) => any;","import { Observable } from './Observable';\r\n\r\nexport class ObservableObject {\r\n\r\n    public static setProperty(object: object, property: string, value) {\r\n        var descriptor = Object.getOwnPropertyDescriptor(object, property);\r\n\r\n        if (!descriptor || (!descriptor.get && !descriptor.set)) {\r\n            var oldValue: any = object[property];\r\n\r\n            Observable.observe(object, property, value);\r\n\r\n            if (oldValue !== value) {\r\n                Observable.notifyChanged(object);\r\n            }\r\n        }\r\n        else {\r\n            object[property] = value;\r\n        }\r\n    }\r\n\r\n    public static removeProperty(object: object, property: string) {\r\n        if (!object.hasOwnProperty(property)) {\r\n            return;\r\n        }\r\n\r\n        delete object[property];\r\n        Observable.notifyChanged(object);\r\n    }\r\n}","import { Utility } from './Utility';\r\n\r\nconst GlobalName = \"$global\";\r\nconst EventName = \"$event\";\r\nconst ElementName = \"$element\";\r\nconst ContextName = \"this\";\r\n\r\nconst reservedKeywords: Array<string> = [\r\n    'break', 'case', 'catch', 'continue', 'debugger', 'default', 'delete', 'do',\r\n    'else', 'finally', 'for', 'function', 'if', 'in', 'instanceof', 'new', 'return',\r\n    'switch', 'this', 'throw', 'try', 'typeof', 'var', 'void', 'while',\r\n    'class', 'null', 'undefined', 'true', 'false', 'with', EventName, ElementName, GlobalName,\r\n    'let', 'abstract', 'import', 'yield', 'arguments'\r\n];\r\n\r\nconst normalExpGetter: { [exp: string]: Function } = {};\r\nconst interpolationExpGetter: { [exp: string]: Function } = {};\r\nconst identifierCache: { [exp: string]: { formated: string, identifiers: string[] } } = {};\r\n\r\nconst reIdentifier = /(\"|').*?\\1|[a-zA-Z$_][a-z0-9A-Z$_]*/g;\r\nconst reInterpolation = /\\{\\{((.|\\n)+?)\\}\\}/g;\r\nconst reBrackets = /^\\([^)]*\\)/;\r\nconst reObjectKey = /[{,]\\s*$/;\r\nconst reColon = /^\\s*:/;\r\nconst reAnychar = /\\S+/;\r\n\r\nfunction isObjectKey(str: string): boolean {\r\n    return str.match(reObjectKey) != null;\r\n}\r\n\r\nfunction isColon(str: string): boolean {\r\n    return str.match(reColon) != null;\r\n}\r\n\r\nfunction isCallFunction(str: string): boolean {\r\n    return str.match(reBrackets) != null;\r\n}\r\n\r\nfunction parseIdentifier(str: string) {\r\n    let cache = identifierCache[str];\r\n\r\n    if (!cache) {\r\n        let index = 0;\r\n        let identifiers = [];\r\n\r\n        let formated = str.replace(reIdentifier, function (x, p, i) {\r\n            if (p === '\"' || p === \"'\" || str[i - 1] === '.' || (x[0] === 'x' && str[i - 1] === '0')) {\r\n                // 如果是字符串: \"aaa\"\r\n                // 或对象的属性: .aaa\r\n                index = i + x.length;\r\n                return x;\r\n            }\r\n\r\n            let prevStr = str.slice(index, i);     // 前一个字符\r\n            let nextStr = str.slice(i + x.length); // 后一个字符\r\n            index = i + x.length;\r\n\r\n            if (isColon(nextStr) && isObjectKey(prevStr)) {\r\n                // 如果前一个字符是冒号，再判断是否是对象的Key\r\n                return x;\r\n            }\r\n\r\n            if (reservedKeywords.indexOf(x) > -1) {\r\n                // 如果是保留关键字直接返回原字符串\r\n                return x;\r\n            }\r\n\r\n            // if (isCallFunction(nextStr)) {\r\n            //     // 如果后面有连续的字符是一对括号则为方法调用\r\n            //     // method(a) 会转成 this.method(a)\r\n            //     return contextName + '.' + x;\r\n            // }\r\n\r\n            if (identifiers.indexOf(x) < 0) {\r\n                // 标记未添加到列表\r\n                identifiers.push(x);\r\n            }\r\n\r\n            // 否则为属性访问， 直接加上下文\r\n            // a 转成  this.a\r\n            return ContextName + '.' + x;\r\n        });\r\n\r\n        cache = {\r\n            formated,\r\n            identifiers\r\n        };\r\n\r\n        identifierCache[str] = cache;\r\n    }\r\n\r\n    return cache;\r\n}\r\n\r\nfunction createFunction(expression, ...args: Array<string>): any {\r\n    try {\r\n        return Function.apply(Function, args);\r\n    }\r\n    catch (err) {\r\n        Utility.error(`Error in parsing expression \"${expression}\":\\n`, args[args.length - 1]);\r\n    }\r\n}\r\n\r\nfunction fixExpression(exp: string) {\r\n    return exp.trim().replace(/\\r\\n|\\n/g, ' ');\r\n}\r\n\r\nexport class ExpParser {\r\n\r\n    private static normalExpGetter = normalExpGetter;\r\n    private static interpolationExpGetter = interpolationExpGetter;\r\n\r\n    public static registerParsedExp(map: { normal: { [exp: string]: Function }, interpolation: { [exp: string]: Function } }) {\r\n        if (map.normal) {\r\n            Object.keys(map.normal).forEach(exp => {\r\n                let fn = map.normal[exp];\r\n                if (!normalExpGetter[exp] && fn != null) {\r\n                    normalExpGetter[exp] = fn;\r\n                }\r\n            });\r\n        }\r\n        if (map.interpolation) {\r\n            Object.keys(map.interpolation).forEach(exp => {\r\n                let fn = map.interpolation[exp];\r\n                if (!interpolationExpGetter[exp] && fn != null) {\r\n                    interpolationExpGetter[exp] = fn;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    public static parseNormalExp(expression: string): Function {\r\n        if (!(typeof expression === 'string' && reAnychar.test(expression))) {\r\n            Utility.error(`[parseNormalExp]Invalid expression, empty string \"${expression}\"`);\r\n            return;\r\n        }\r\n\r\n        expression = fixExpression(expression);\r\n        let fn = normalExpGetter[expression];\r\n\r\n        if (!fn) {\r\n            let detail = parseIdentifier(expression);\r\n            let fnBody = `try{${detail.formated.trim().match(';$') ? detail.formated : \"return (\" + detail.formated + \");\"}}catch(e){}`;\r\n\r\n            fn = createFunction(expression, EventName, ElementName, GlobalName, fnBody);\r\n            normalExpGetter[expression] = fn;\r\n        }\r\n\r\n        return fn;\r\n    }\r\n\r\n    public static parseInterpolationExp(expression: string): Function {\r\n        console.assert(this.hasInterpolation(expression), `[parseInterpolationToGetter] error`, expression);\r\n\r\n        expression = fixExpression(expression);\r\n        let getter = interpolationExpGetter[expression];\r\n\r\n        if (!getter) {\r\n            let tokens = [];\r\n            let index = 0;\r\n            let length = expression.length;\r\n            expression.replace(reInterpolation, ($0, exp, $2, i) => {\r\n                if (i > index) {\r\n                    tokens.push(`\"${expression.slice(index, i).split(/\\r\\n|\\n/).join('\"+\"')}\"`);\r\n                }\r\n                tokens.push('(' + parseIdentifier(exp.trim()).formated + ')');\r\n                index = i + $0.length;\r\n\r\n                return $0;\r\n            });\r\n\r\n            if (index < length && index !== 0) {\r\n                tokens.push(`\"${expression.slice(index).split(/\\r\\n|\\n/).join('\"+\"')}\"`);\r\n            }\r\n\r\n            if (!tokens.length) {\r\n                return;\r\n            }\r\n\r\n            let fnBody = \"try{return (\" + tokens.join('+') + \")}catch(e){}\";\r\n            getter = interpolationExpGetter[expression] = createFunction(expression, EventName, ElementName, GlobalName, fnBody);\r\n        }\r\n\r\n        return getter;\r\n    }\r\n\r\n    public static hasInterpolation(str: string): boolean {\r\n        return typeof str === 'string' && str.match(reAnychar) !== null && str.match(reInterpolation) !== null;\r\n    }\r\n\r\n}","import { VirtualNode } from './ViewManager';\r\nimport { Utility } from './Utility';\r\n\r\n// Regular Expressions for parsing tags and attributes\r\nvar startTag = /^<([-A-Za-z0-9_]+)((?:\\s+[a-zA-Z_:@][-a-zA-Z0-9_:.]*(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?)*)\\s*(\\/?)>/,\r\n    endTag = /^<\\/([-A-Za-z0-9_]+)[^>]*>/,\r\n    attr = /([a-zA-Z_:@][-a-zA-Z0-9_:.]*)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/g;\r\n\r\n// Empty Elements - HTML 5\r\nvar empty = makeMap(\"area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr\");\r\n\r\n// Block Elements - HTML 5\r\nvar block = makeMap(\"a,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video\");\r\n\r\n// Inline Elements - HTML 5\r\nvar inline = makeMap(\"abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var\");\r\n\r\n// Elements that you can, intentionally, leave open\r\n// (and which close themselves)\r\nvar closeSelf = makeMap(\"colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr\");\r\n\r\n// Attributes that have their values filled in disabled=\"disabled\"\r\nvar fillAttrs = makeMap(\"checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected\");\r\n\r\n// Special Elements (can contain anything)\r\nvar special = makeMap(\"script,style\");\r\n\r\nexport function processHtml(html, handler) {\r\n    var index, chars, match, stack = [],\r\n        last = html;\r\n    var getStackLast = function () {\r\n        return stack[stack.length - 1];\r\n    };\r\n\r\n    while (html) {\r\n        chars = true;\r\n\r\n        // Make sure we're not in a script or style element\r\n        if (!getStackLast() || !special[getStackLast()]) {\r\n\r\n            // Comment\r\n            if (html.indexOf(\"<!--\") == 0) {\r\n                index = html.indexOf(\"-->\");\r\n\r\n                if (index >= 0) {\r\n                    if (handler.comment)\r\n                        handler.comment(html.substring(4, index));\r\n                    html = html.substring(index + 3);\r\n                    chars = false;\r\n                }\r\n\r\n                // end tag\r\n            } else if (html.indexOf(\"</\") == 0) {\r\n                match = html.match(endTag);\r\n\r\n                if (match) {\r\n                    html = html.substring(match[0].length);\r\n                    match[0].replace(endTag, parseEndTag);\r\n                    chars = false;\r\n                }\r\n\r\n                // start tag\r\n            } else if (html.indexOf(\"<\") == 0) {\r\n                match = html.match(startTag);\r\n\r\n                if (match) {\r\n                    html = html.substring(match[0].length);\r\n                    match[0].replace(startTag, parseStartTag);\r\n                    chars = false;\r\n                }\r\n            }\r\n\r\n            if (chars) {\r\n                index = html.indexOf(\"<\");\r\n\r\n                var text = index < 0 ? html : html.substring(0, index);\r\n                html = index < 0 ? \"\" : html.substring(index);\r\n\r\n                if (handler.chars)\r\n                    handler.chars(text);\r\n            }\r\n\r\n        } else {\r\n            html = html.replace(new RegExp(\"([\\\\s\\\\S]*?)<\\/\" + getStackLast() + \"[^>]*>\"), function (all, text) {\r\n                text = text.replace(/<!--([\\s\\S]*?)-->|<!\\[CDATA\\[([\\s\\S]*?)]]>/g, \"$1$2\");\r\n                if (handler.chars)\r\n                    handler.chars(text);\r\n\r\n                return \"\";\r\n            });\r\n\r\n            parseEndTag(\"\", getStackLast());\r\n        }\r\n\r\n        if (html == last)\r\n            throw \"Parse Error: \" + html;\r\n        last = html;\r\n    }\r\n\r\n    // Clean up any remaining tags\r\n    parseEndTag(undefined, undefined);\r\n\r\n    function parseStartTag(tag, tagName, rest, unary) {\r\n        // tagName = tagName.toLowerCase();\r\n\r\n        if (block[tagName]) {\r\n            while (getStackLast() && inline[getStackLast()]) {\r\n                parseEndTag(\"\", getStackLast());\r\n            }\r\n        }\r\n\r\n        if (closeSelf[tagName] && getStackLast() == tagName) {\r\n            parseEndTag(\"\", tagName);\r\n        }\r\n\r\n        unary = empty[tagName] || !!unary;\r\n\r\n        if (!unary)\r\n            stack.push(tagName);\r\n\r\n        if (handler.start) {\r\n            var attrs = [];\r\n\r\n            rest.replace(attr, function (match, name) {\r\n                var value = arguments[2] ? arguments[2] :\r\n                    arguments[3] ? arguments[3] :\r\n                        arguments[4] ? arguments[4] :\r\n                            fillAttrs[name] ? name : \"\";\r\n\r\n                attrs.push({\r\n                    name: name,\r\n                    value: value,\r\n                    escaped: value.replace(/(^|[^\\\\])\"/g, '$1\\\\\\\"') //\"\r\n                });\r\n            });\r\n\r\n            if (handler.start)\r\n                handler.start(tagName, attrs, unary);\r\n        }\r\n    }\r\n\r\n    function parseEndTag(tag, tagName) {\r\n        // If no tag name is provided, clean shop\r\n        if (!tagName)\r\n            var pos = 0;\r\n\r\n        // Find the closest opened tag of the same type\r\n        else\r\n            for (var pos = stack.length - 1; pos >= 0; pos--)\r\n                if (stack[pos] == tagName)\r\n                    break;\r\n\r\n        if (pos >= 0) {\r\n            // Close all the open elements, up the stack\r\n            for (var i = stack.length - 1; i >= pos; i--)\r\n                if (handler.end)\r\n                    handler.end(stack[i]);\r\n\r\n            // Remove the open elements from the stack\r\n            stack.length = pos;\r\n        }\r\n    }\r\n}\r\n\r\nexport function parseTemplateToVirtualNode(html: string): VirtualNode {\r\n    var bufArray = [];\r\n    var results = {\r\n        type: 'root',\r\n        child: [],\r\n    };\r\n    processHtml(html, {\r\n        start: function (tag, attrs, unary) {\r\n            // node for this element\r\n            var node: VirtualNode = {\r\n                type: 'element',\r\n                tag: tag,\r\n            };\r\n            if (attrs.length !== 0) {\r\n                node.attr = attrs.reduce(function (pre, attr) {\r\n                    var name = attr.name;\r\n                    var value = attr.value;\r\n\r\n                    // has multi attibutes\r\n                    // make it array of attribute\r\n                    // if (value.match(/ /)) {\r\n                    //     value = value.split(' ');\r\n                    // }\r\n\r\n                    // if attr already exists\r\n                    // merge it\r\n                    if (pre[name]) {\r\n                        if (Array.isArray(pre[name])) {\r\n                            // already array, push to last\r\n                            pre[name].push(value);\r\n                        } else {\r\n                            // single value, make it array\r\n                            pre[name] = [pre[name], value];\r\n                        }\r\n                    } else {\r\n                        // not exist, put it\r\n                        pre[name] = value;\r\n                    }\r\n\r\n                    return pre;\r\n                }, {});\r\n            }\r\n            if (unary) {\r\n                // if this tag dosen't have end tag\r\n                // like <img src=\"hoge.png\"/>\r\n                // add to parents\r\n                var parent = bufArray[0] || results;\r\n                if (parent.child === undefined) {\r\n                    parent.child = [];\r\n                }\r\n                parent.child.push(node);\r\n            } else {\r\n                bufArray.unshift(node);\r\n            }\r\n        },\r\n        end: function (tag) {\r\n            // merge into parent tag\r\n            var node = bufArray.shift();\r\n            if (node.tag !== tag) console.error('invalid state: mismatch end tag');\r\n\r\n            if (bufArray.length === 0) {\r\n                results.child.push(node);\r\n            } else {\r\n                var parent = bufArray[0];\r\n                if (parent.child === undefined) {\r\n                    parent.child = [];\r\n                }\r\n                parent.child.push(node);\r\n            }\r\n        },\r\n        chars: function (text) {\r\n            if (/\\S/.test(text) && bufArray.length != 0) {\r\n                var parent = bufArray[0];\r\n                if (parent.tag === \"text\") {\r\n                    var node = {\r\n                        type: 'text',\r\n                        text: text,\r\n                    };\r\n                    if (parent.child === undefined) {\r\n                        parent.child = [];\r\n                    }\r\n                    parent.child.push(node);\r\n                }\r\n            }\r\n        },\r\n        comment: function (text) {\r\n            // debug(text);\r\n            // var node = {\r\n            //   node: 'comment',\r\n            //   text: text,\r\n            // };\r\n            // var parent = bufArray[0];\r\n            // if (parent.child === undefined) {\r\n            //   parent.child = [];\r\n            // }\r\n            // parent.child.push(node);\r\n        },\r\n    });\r\n    if (results.child.length > 1) {\r\n        Utility.error(`Invalid template, one root node required!`);\r\n    }\r\n    return results.child[0];\r\n}\r\n\r\nfunction makeMap(str) {\r\n    var obj = {},\r\n        items = str.split(\",\");\r\n    for (var i = 0; i < items.length; i++)\r\n        obj[items[i]] = true;\r\n    return obj;\r\n}","import { VirtualNode } from './ViewManager';\r\nimport { parseTemplateToVirtualNode } from './TemplateParser';\r\n\r\nexport class TemplateManager {\r\n\r\n    private static registeredParsedTemplateByName: { [name: string]: VirtualNode } = {};\r\n\r\n    public static registerHtmlTemplate(name: string, template: string) {\r\n        this.registeredParsedTemplateByName[name] = parseTemplateToVirtualNode(template);\r\n    }\r\n\r\n    public static registerJsonTemplate(name: string, template: VirtualNode) {\r\n        this.registeredParsedTemplateByName[name] = template;\r\n    }\r\n\r\n    public static getTemplateByName(name: string) {\r\n        return this.registeredParsedTemplateByName[name];\r\n    }\r\n}","import { Utility } from './Utility';\r\nimport { SpriteProps, ActionQueue, ActionRepeatMode } from 'canvas2djs';\r\n\r\nexport class StyleManager {\r\n\r\n    private static registeredStyle: { [name: string]: any } = {};\r\n\r\n    public static registerStyle<T>(name: string, styleProps: T) {\r\n        if (this.registeredStyle[name] != null) {\r\n            Utility.warn(`Style \"${name}\" is overried`);\r\n        }\r\n        this.registeredStyle[name] = styleProps;\r\n    }\r\n\r\n    public static registerStyleMap(namespace: string, styleMap: { [name: string]: any }) {\r\n        for (let name in styleMap) {\r\n            this.registerStyle(`${namespace}-${name}`, styleMap[name]);\r\n        }\r\n    }\r\n\r\n    public static getStyleByName<T>(name: string): T {\r\n        return this.registeredStyle[name];\r\n    }\r\n\r\n    public static getAllRegisterStyles() {\r\n        return { ...this.registeredStyle };\r\n    }\r\n}\r\n\r\nexport type ActionStyle = {\r\n    startProps?: SpriteProps;\r\n    repeatMode?: ActionRepeatMode;\r\n    queue: ActionQueue;\r\n}","import { Sprite, TextLabel, ITextLabel, BMFontLabel, SpriteProps, Action, ActionQueue, ActionRepeatMode } from 'canvas2djs';\r\nimport { Utility } from './Utility';\r\n// import { Parser } from './Parser';\r\nimport { ExpParser } from './ExpParser';\r\nimport { ComponentManager, IComponent } from './ComponentManager';\r\nimport { TemplateManager } from './TemplateManager';\r\nimport { StyleManager, ActionStyle } from './StyleManager';\r\nimport { Observable } from './Observable';\r\nimport { BindingManager } from './BindingManager';\r\nimport { ScrollView } from './ScrollView';\r\nimport { AutoLayoutView } from './AutoLayoutView';\r\nimport { AutoResizeView } from './AutoResizeView';\r\n\r\nconst reBindableAttr = /^[:@]/;\r\n\r\nexport class ViewManager {\r\n\r\n    public static createView(node: VirtualNode): VirtualView {\r\n        if (node.attr) {\r\n            let terminalDirective = BindingManager.getHighestPriorityTerminal(node.attr);\r\n            if (terminalDirective != null) {\r\n                let sprite = new Sprite();\r\n                let attr = { ...node.attr };\r\n                delete attr[terminalDirective];\r\n                return {\r\n                    node: { ...node, attr, },\r\n                    sprite,\r\n                    instance: sprite,\r\n                    directives: { [terminalDirective]: node.attr[terminalDirective] },\r\n                };\r\n            }\r\n        }\r\n        let ctor = ComponentManager.getBaseComponentCtorByName(node.tag);\r\n        if (ctor != null) {\r\n            return this.createSprite(node, new ctor());\r\n        }\r\n        if (node.tag === \"text\" || node.tag === \"bmfont\") {\r\n            return this.createTextLabel(node);\r\n        }\r\n\r\n        return this.createComponent(node);\r\n    }\r\n\r\n    public static createSprite(node: VirtualNode, sprite: Sprite<{}>) {\r\n        let view: VirtualView = { instance: sprite, sprite, };\r\n\r\n        if (node.attr) {\r\n            let directives: { [name: string]: any };\r\n            for (let name in node.attr) {\r\n                let value = node.attr[name];\r\n                if (BindingManager.isRegisteredDirective(name) || reBindableAttr.test(name) || ExpParser.hasInterpolation(value)) {\r\n                    if (!directives) {\r\n                        directives = {};\r\n                    }\r\n                    directives[name] = value;\r\n                }\r\n                else {\r\n                    this.setAttribute(sprite, name, value);\r\n                }\r\n            }\r\n\r\n            if (directives) {\r\n                view.directives = directives;\r\n            }\r\n        }\r\n        if (node.child) {\r\n            let children: VirtualView[] = [];\r\n            for (let i = 0, vn: VirtualNode; vn = node.child[i]; i++) {\r\n                let v = this.createView(vn);\r\n                sprite.addChild(v.sprite);\r\n                children.push(v);\r\n            }\r\n            view.child = children;\r\n        }\r\n\r\n        return view;\r\n    }\r\n\r\n    public static createTextLabel(node: VirtualNode) {\r\n        let textLabel = node.tag === 'text' ? new TextLabel() : new BMFontLabel();\r\n        let view: VirtualView = { instance: textLabel, sprite: textLabel, };\r\n\r\n        if (node.attr) {\r\n            let directives: { [name: string]: any };\r\n            for (let name in node.attr) {\r\n                let value = node.attr[name];\r\n                if (BindingManager.isRegisteredDirective(name) || reBindableAttr.test(name) || ExpParser.hasInterpolation(value)) {\r\n                    if (!directives) {\r\n                        directives = {};\r\n                    }\r\n                    directives[name] = value;\r\n                }\r\n                else {\r\n                    this.setAttribute(textLabel, name, value);\r\n                }\r\n            }\r\n            if (directives) {\r\n                view.directives = directives;\r\n            }\r\n        }\r\n        if (node.child) {\r\n            let content = node.child.map(child => {\r\n                if (child.type !== 'text') {\r\n                    return Utility.error(`<text> only supports text content.`);\r\n                }\r\n                return child.text;\r\n            }).join(\"\");\r\n            if (ExpParser.hasInterpolation(content)) {\r\n                if (!view.directives) {\r\n                    view.directives = {};\r\n                }\r\n                view.directives.text = content;\r\n            }\r\n            else {\r\n                textLabel.text = content;\r\n            }\r\n        }\r\n        return view;\r\n    }\r\n\r\n    public static createComponent(node: VirtualNode) {\r\n        let component = ComponentManager.createComponentByName(node.tag);\r\n        let view: VirtualView = { instance: component, isComponent: true, };\r\n        let sprite\r\n\r\n        if (node.attr) {\r\n            let directives: { [name: string]: any };\r\n            for (let name in node.attr) {\r\n                let value = node.attr[name];\r\n                if (BindingManager.isRegisteredDirective(name) || reBindableAttr.test(name) || ExpParser.hasInterpolation(value)) {\r\n                    if (!directives) {\r\n                        directives = {};\r\n                    }\r\n                    directives[name] = value;\r\n                }\r\n                else if (name !== 'template') {\r\n                    this.setAttribute(component, name, value);\r\n                }\r\n            }\r\n            if (directives) {\r\n                view.directives = directives;\r\n            }\r\n\r\n            if (node.attr.template) {\r\n                let template = TemplateManager.getTemplateByName(node.attr.template);\r\n                if (template == null) {\r\n                    Utility.error(`Template \"${node.attr.template}\" not found.`);\r\n                }\r\n\r\n                let templateView = this.createView(template);\r\n                view.sprite = templateView.sprite;\r\n                view.child = [templateView];\r\n            }\r\n            else {\r\n                Utility.error(`Template of component \"${node.tag}\" not given.`);\r\n            }\r\n        }\r\n        if (node.child) {\r\n            view.nestChild = node.child.map(c => this.createView(c));\r\n        }\r\n\r\n        return view;\r\n    }\r\n\r\n    public static setAttribute(object, attrName: string, attrValue: any) {\r\n        if (attrName === \"styles\") {\r\n            if (typeof object.setProps === 'function') {\r\n                let styleProps: SpriteProps;\r\n                if (typeof attrValue === 'string') {\r\n                    attrValue = attrValue.trim().split(/\\s+/);\r\n                }\r\n                else if (Object.prototype.toString.call(attrValue) === '[object Object]') {\r\n                    attrValue = Object.keys(attrValue).filter(name => !!attrValue[name]);\r\n                }\r\n                if (Array.isArray(attrValue)) {\r\n                    styleProps = {};\r\n                    for (let i = 0, styleName: string, l = attrValue.length; i < l; i++) {\r\n                        styleName = attrValue[i];\r\n                        let style = StyleManager.getStyleByName(styleName);\r\n                        if (!style) {\r\n                            Utility.warn(`Style \"${styleName}\" not found.`);\r\n                        }\r\n                        else {\r\n                            styleProps = { ...styleProps, ...style };\r\n                        }\r\n                    }\r\n                }\r\n                // else if (Object.prototype.toString.call(attrValue) === '[object Object]') {\r\n                //     styleProps = attrValue;\r\n                // }\r\n                else {\r\n                    return Utility.warn(`Invalid style value:`, attrValue);\r\n                }\r\n                object.setProps(styleProps);\r\n            }\r\n            else {\r\n                object[attrName] = attrValue;\r\n            }\r\n            return;\r\n        }\r\n        if (attrName === 'actions') {\r\n            if (typeof attrValue === 'string') {\r\n                let style = StyleManager.getStyleByName(attrValue) as ActionStyle;\r\n                if (style == null) {\r\n                    return Utility.error(`Action \"${attrValue}\" not found.`);\r\n                }\r\n                if (style.startProps) {\r\n                    object.setProps(style.startProps);\r\n                }\r\n                let action = new Action(object, name).queue(style.queue);\r\n                if (style.repeatMode != null) {\r\n                    action.setRepeatMode(style.repeatMode);\r\n                }\r\n                action.start();\r\n            }\r\n            else if (Object.prototype.toString.call(attrValue) === '[object Object]') {\r\n                for (let name in attrValue) {\r\n                    if (!attrValue[name]) {\r\n                        Action.stop(object, name);\r\n                        continue;\r\n                    }\r\n                    let style = StyleManager.getStyleByName(name) as ActionStyle;\r\n                    if (style == null) {\r\n                        Utility.error(`Action \"${name}\" not found.`);\r\n                        continue;\r\n                    }\r\n                    if (style.startProps) {\r\n                        object.setProps(style.startProps);\r\n                    }\r\n                    let action = new Action(object, name).queue(style.queue);\r\n                    if (style.repeatMode != null) {\r\n                        action.setRepeatMode(style.repeatMode);\r\n                    }\r\n                    action.start();\r\n                }\r\n            }\r\n            else {\r\n                Utility.error(`Invalid action directive, value is not an object`, attrValue);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let registerProperties = ComponentManager.getRegisteredComponentProperties(object);\r\n        if (!registerProperties || registerProperties[attrName] == null || attrValue == null) {\r\n            return object[attrName] = attrValue;\r\n        }\r\n\r\n        let ctor = registerProperties[attrName];\r\n        if (Array.isArray(ctor)) {\r\n            if (ctor.some(f => attrValue.constructor === f)) {\r\n                object[attrName] = attrValue;\r\n            }\r\n            else {\r\n                Utility.warn(`TypeError for attribute \"${attrName}\"`, object, attrValue);\r\n            }\r\n            return;\r\n        }\r\n\r\n        switch (registerProperties[attrName]) {\r\n            case Function:\r\n            case Object:\r\n            case Array:\r\n                if (attrValue.constructor !== registerProperties[attrName]) {\r\n                    Utility.warn(`TypeError for attribute \"${attrName}\"`, object, attrValue);\r\n                }\r\n                else {\r\n                    object[attrName] = attrValue;\r\n                }\r\n                break;\r\n            case Boolean:\r\n                if (attrValue === 'true') {\r\n                    object[attrName] = true;\r\n                }\r\n                else if (attrValue === 'false') {\r\n                    object[attrName] = false;\r\n                }\r\n                else {\r\n                    object[attrName] = !!attrValue;\r\n                }\r\n                break;\r\n            case Number:\r\n                attrValue = Number(attrValue);\r\n                if (!isNaN(attrValue)) {\r\n                    object[attrName] = attrValue;\r\n                }\r\n                break;\r\n            case String:\r\n                if (Object.prototype.toString.call(attrValue) === '[object Object]') {\r\n                    let values = Object.keys(attrValue).filter(name => !!attrValue[name]);\r\n                    if (values.length) {\r\n                        object[attrName] = values[values.length - 1];\r\n                    }\r\n                }\r\n                else {\r\n                    attrValue = String(attrValue);\r\n                    object[attrName] = attrValue;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport type VirtualNode = {\r\n    type: \"text\" | \"element\";\r\n    text?: string;\r\n    tag?: string;\r\n    attr?: { [name: string]: string };\r\n    child?: VirtualNode[];\r\n}\r\n\r\nexport type VirtualView = {\r\n    instance: any;\r\n    sprite?: Sprite<{}>;\r\n    child?: VirtualView[];\r\n    nestChild?: VirtualView[];\r\n    directives?: { [name: string]: string };\r\n    isComponent?: boolean;\r\n    node?: VirtualNode;\r\n}","import { Utility } from './Utility';\r\nimport { Observer } from './Observer';\r\n// import { Parser } from './Parser';\r\nimport { ExpParser } from './ExpParser';\r\nimport { Observable } from './Observable';\r\nimport { WatcherManager } from './WatcherManager';\r\n\r\nexport class Watcher {\r\n\r\n    public static getKey(exp: string, isDeepWatch?: boolean): string {\r\n        return !!isDeepWatch ? exp + '<deep>' : exp;\r\n    }\r\n\r\n    private callbacks: WatcherCallback[] = [];\r\n    private hasInterpolation: boolean;\r\n    private observers: { [id: string]: Observer } = {};\r\n    private properties: { [number: string]: { [property: string]: boolean } } = {};\r\n    private tmpObservers: { [id: string]: Observer };\r\n    private tmpProperties: { [number: string]: { [property: string]: boolean } };\r\n    private valueGetter: Function;\r\n\r\n    public isActived: boolean = true;\r\n    public value: any;\r\n\r\n    constructor(\r\n        public component,\r\n        public exp: string,\r\n        public isDeepWatch?: boolean\r\n    ) {\r\n        this.hasInterpolation = ExpParser.hasInterpolation(exp);\r\n        this.valueGetter = this.hasInterpolation ? ExpParser.parseInterpolationExp(exp) : ExpParser.parseNormalExp(exp);\r\n\r\n        this.propertyChanged = this.propertyChanged.bind(this);\r\n        this.value = this.getValue();\r\n    }\r\n\r\n    public addCallback(callback: WatcherCallback) {\r\n        if (!this.isActived) {\r\n            return;\r\n        }\r\n        Utility.addEnsureUniqueArrayItem(callback, this.callbacks);\r\n    }\r\n\r\n    public removeCallback(callback: WatcherCallback) {\r\n        if (!this.isActived) {\r\n            return;\r\n        }\r\n        Utility.removeItemFromArray(callback, this.callbacks);\r\n        if (!this.callbacks.length) {\r\n            this.destroy();\r\n        }\r\n    }\r\n\r\n    public destroy() {\r\n        if (!this.isActived) {\r\n            return;\r\n        }\r\n\r\n        for (let id in this.observers) {\r\n            let ps = this.properties[id];\r\n            for (let property in ps) {\r\n                this.observers[id].removeListener(property, this.propertyChanged);\r\n            }\r\n        }\r\n\r\n        let key: string = Watcher.getKey(this.exp, this.isDeepWatch);\r\n\r\n        WatcherManager.removeWatcher(this.component, key);\r\n\r\n        this.propertyChanged = this.value = this.component = this.exp = this.valueGetter = null;\r\n        this.callbacks = this.observers = this.properties = this.tmpProperties = this.tmpObservers = null;\r\n        this.isActived = false;\r\n    }\r\n\r\n    private propertyChanged(): void {\r\n        Utility.nextTick(this.flush, this);\r\n        // this.flush();\r\n    }\r\n\r\n    private flush() {\r\n        if (!this.isActived) {\r\n            return;\r\n        }\r\n\r\n        let oldValue: any = this.value;\r\n        let newValue: any = this.getValue();\r\n\r\n        if ((typeof newValue === 'object' && newValue != null) || newValue !== oldValue) {\r\n            this.value = newValue;\r\n            let list = this.callbacks.slice();\r\n            for (let i = 0, callback: Function; callback = list[i]; i++) {\r\n                if (this.isActived) {\r\n                    callback(newValue, oldValue);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getValue(): any {\r\n        this.beforeCallValueGetter();\r\n\r\n        let newValue = this.valueGetter.call(this.component, null, null, window);\r\n\r\n        if (this.isDeepWatch) {\r\n            recusiveVisit(newValue);\r\n        }\r\n\r\n        this.afterCallValueGetter();\r\n        return newValue;\r\n    }\r\n\r\n    private beforeCallValueGetter(): void {\r\n        this.tmpObservers = {};\r\n        this.tmpProperties = {};\r\n        Observable.setBeforeAccessPropertyCallback(this.subscribePropertyChanged.bind(this))\r\n    }\r\n\r\n    private afterCallValueGetter(): void {\r\n        Observable.setBeforeAccessPropertyCallback(null);\r\n\r\n        let { observers, properties, tmpObservers, tmpProperties, propertyChanged } = this;\r\n\r\n        for (let id in observers) {\r\n            let observer = observers[id];\r\n            let ps = properties[id];\r\n\r\n            if (!tmpObservers[id]) {\r\n                for (let property in ps) {\r\n                    observer.removeListener(property, propertyChanged);\r\n                }\r\n            }\r\n            else {\r\n                for (let property in ps) {\r\n                    if (!tmpProperties[id][property]) {\r\n                        observer.removeListener(property, propertyChanged);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.observers = tmpObservers;\r\n        this.properties = tmpProperties;\r\n    }\r\n\r\n    private subscribePropertyChanged(observer: Observer, property: string) {\r\n        let id = Utility.getUid(observer);\r\n        let { observers, properties, tmpObservers, tmpProperties, propertyChanged } = this;\r\n\r\n        if (!tmpObservers[id]) {\r\n            tmpObservers[id] = observer;\r\n            tmpProperties[id] = { [property]: true };\r\n\r\n\r\n            if (!observers[id]) {\r\n                observers[id] = observer;\r\n                properties[id] = { [property]: true };\r\n\r\n                observer.addListener(property, propertyChanged);\r\n            }\r\n            else if (!properties[id][property]) {\r\n                properties[id][property] = true;\r\n                observer.addListener(property, propertyChanged);\r\n            }\r\n        }\r\n        else if (!tmpProperties[id][property]) {\r\n            tmpProperties[id][property] = true;\r\n\r\n            if (!properties[id][property]) {\r\n                observer.addListener(property, propertyChanged);\r\n                properties[id][property] = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction recusiveVisit(value: any) {\r\n    if (Utility.isPlainObjectOrObservableObject(value)) {\r\n        for (let key in value) {\r\n            recusiveVisit(value[key]);\r\n        }\r\n    }\r\n    else if (Array.isArray(value)) {\r\n        for (let i = 0, l = value.length; i < l; i++) {\r\n            let item = value[i];\r\n            recusiveVisit(item);\r\n        }\r\n    }\r\n}\r\n\r\nexport type WatcherCallback = (newValue, oldValue) => any;","import { IComponent } from './ComponentManager';\r\nimport { WatcherCallback, Watcher } from './Watcher';\r\nimport { Utility } from './Utility';\r\n\r\nexport class WatcherManager {\r\n\r\n    private static componentWatchers: { [uid: string]: { [key: string]: Watcher } } = {};\r\n\r\n    public static watch(component: IComponent, expression: string, callback: WatcherCallback, isDeepWatch?: boolean, immediate?: boolean) {\r\n        let uid = Utility.getUid(component);\r\n        if (!this.componentWatchers[uid]) {\r\n            this.componentWatchers[uid] = {};\r\n        }\r\n        let key = Watcher.getKey(expression, isDeepWatch);\r\n        if (!this.componentWatchers[uid][key]) {\r\n            this.componentWatchers[uid][key] = new Watcher(component, expression, isDeepWatch);\r\n        }\r\n        let watcher = this.componentWatchers[uid][key];\r\n        let wrappedCallback = (...args: any[]) => {\r\n            callback.apply(component, args);\r\n        };\r\n        watcher.addCallback(wrappedCallback);\r\n\r\n        if (immediate) {\r\n            wrappedCallback(watcher.value, undefined);\r\n        }\r\n        return () => {\r\n            watcher.removeCallback(wrappedCallback);\r\n        };\r\n    }\r\n\r\n    public static removeWatcher(component: IComponent, key: string) {\r\n        let watchers = this.componentWatchers[Utility.getUid(component)];\r\n        if (watchers) {\r\n            delete watchers[key];\r\n        }\r\n    }\r\n\r\n    public static removeWatchers(component: IComponent) {\r\n        let uid = Utility.getUid(component);\r\n        let watchers = this.componentWatchers[uid];\r\n        if (watchers) {\r\n            for (let key in watchers) {\r\n                watchers[key].destroy();\r\n            }\r\n        }\r\n        delete this.componentWatchers[uid];\r\n    }\r\n}","import { IComponent, ComponentManager } from './ComponentManager';\r\nimport { VirtualView, ViewManager } from './ViewManager';\r\nimport { Utility } from './Utility';\r\n// import { Parser } from './Parser';\r\nimport { ExpParser } from './ExpParser';\r\nimport { WatcherManager } from './WatcherManager';\r\nimport { EventEmitter } from 'canvas2djs';\r\n\r\nexport class BindingManager {\r\n\r\n    private static activedDirectives: { [uid: string]: boolean } = {};\r\n    private static terminalDirectives: string[] = [];\r\n    private static registeredDirectives: { [name: string]: { ctor: Function; isTerminal?: boolean; priority?: number; } } = {};\r\n    private static componentDirectives: { [id: string]: IDirective[] } = {};\r\n\r\n    public static registerDirective(name: string, directiveCtor: Function, isTerminal?: boolean, priority?: number) {\r\n        if (this.registeredDirectives[name] != null) {\r\n            Utility.warn(`Directive \"${name}\" is override.`, directiveCtor);\r\n        }\r\n        this.registeredDirectives[name] = { ctor: directiveCtor, isTerminal, priority };\r\n        this.terminalDirectives = Object.keys(this.registeredDirectives)\r\n            .filter(name => this.registeredDirectives[name].isTerminal)\r\n            .sort((a, b) => this.registeredDirectives[b].priority - this.registeredDirectives[a].priority);\r\n    }\r\n\r\n    public static getHighestPriorityTerminal(target) {\r\n        return this.terminalDirectives.filter(name => target[name] != null)[0];\r\n    }\r\n\r\n    public static isRegisteredDirective(name: string) {\r\n        return this.registeredDirectives[name] != null;\r\n    }\r\n\r\n    public static createBinding(component: IComponent, view: VirtualView, context = {} as any) {\r\n        let directives = this.getComponentDirectives(component);\r\n        let startIndex = directives.length;\r\n        if (view.directives) {\r\n            for (let name in view.directives) {\r\n                let exp = view.directives[name];\r\n                if (this.registeredDirectives[name]) {\r\n                    this.createDirective(this.registeredDirectives[name].ctor, exp, component, view, context);\r\n                }\r\n                else if (name.slice(0, 2) === '::') {\r\n                    this.createAttributeBinding(name.slice(2), exp, component, view.instance, true);\r\n                }\r\n                else if (name[0] === '@') {\r\n                    this.createEventBinding(name.slice(1), exp, component, view.instance);\r\n                }\r\n                else if (name[0] === ':') {\r\n                    this.createAttributeBinding(name.slice(1), exp, component, view.instance);\r\n                }\r\n                else if (ExpParser.hasInterpolation(exp)) {\r\n                    this.createAttributeBinding(name, exp, component, view.instance);\r\n                }\r\n                else {\r\n                    Utility.warn(`Unknow directive '${name}=\"${exp}\".'`);\r\n                }\r\n            }\r\n        }\r\n        if (view.isComponent) {\r\n            this.createComponentBinding(component, view);\r\n        }\r\n        else if (view.child) {\r\n            for (let i = 0, v: VirtualView; v = view.child[i]; i++) {\r\n                this.createBinding(component, v, context)\r\n            }\r\n        }\r\n\r\n        return directives.slice(startIndex);\r\n    }\r\n\r\n    public static removeBinding(component: IComponent) {\r\n        let uid = Utility.getUid(component);\r\n        let directives = this.componentDirectives[uid];\r\n        if (directives) {\r\n            let list = directives.slice();\r\n            for (let i = 0, directive: IDirective; directive = list[i]; i++) {\r\n                this.removeDirective(component, directive);\r\n            }\r\n            delete this.componentDirectives[uid];\r\n        }\r\n    }\r\n\r\n    public static createDirective(ctor: Function, expression: string, component: IComponent, view: any, context) {\r\n        let directive: IDirective = new (ctor as any)();\r\n        if (typeof directive.onInit === 'function') {\r\n            directive.onInit(expression, component, view, context);\r\n        }\r\n        this.addDirective(component, directive);\r\n    }\r\n\r\n    public static addDirective(component: IComponent, directive: IDirective) {\r\n        if (Utility.addEnsureUniqueArrayItem(directive, this.getComponentDirectives(component))) {\r\n            this.activedDirectives[Utility.getUid(directive)] = true;\r\n        }\r\n    }\r\n\r\n    public static getComponentDirectives(component: IComponent) {\r\n        let uid = Utility.getUid(component);\r\n        if (!this.componentDirectives[uid]) {\r\n            this.componentDirectives[uid] = [];\r\n        }\r\n        return this.componentDirectives[uid];\r\n    }\r\n\r\n    public static removeDirective(component: IComponent, directive: IDirective) {\r\n        let uid = Utility.getUid(directive);\r\n        let directives = this.componentDirectives[Utility.getUid(component)];\r\n        if (!this.activedDirectives[uid] || !directives) {\r\n            return;\r\n        }\r\n        if (typeof directive.onDestroy === 'function') {\r\n            directive.onDestroy();\r\n        }\r\n        Utility.removeItemFromArray(directive, directives);\r\n        delete this.activedDirectives[uid];\r\n    }\r\n\r\n    public static createComponentBinding(component: IComponent, view: VirtualView) {\r\n        let context = {};\r\n        if (view.nestChild) {\r\n            for (let i = 0, v: VirtualView; v = view.nestChild[i]; i++) {\r\n                this.createBinding(component, v, context);\r\n            }\r\n        }\r\n        if (view.child) {\r\n            if (typeof view.instance.onBeforeMount === 'function') {\r\n                view.instance.onBeforeMount(view);\r\n            }\r\n            this.createBinding(view.instance, view.child[0], context);\r\n            if (typeof view.instance.onAfterMounted === 'function') {\r\n                view.instance.onAfterMounted();\r\n            }\r\n            let directive: IDirective = {\r\n                onDestroy: () => {\r\n                    ComponentManager.destroyComponent(view.instance);\r\n                    view.child[0].sprite.release(true);\r\n                },\r\n            };\r\n            this.addDirective(component, directive);\r\n        }\r\n    }\r\n\r\n    public static createAttributeBinding(attrName: string, expression: string, component: IComponent, view, twoWayBinding?: boolean) {\r\n        let value;\r\n        let unWatchComponent = WatcherManager.watch(component, expression, (newValue, oldValue) => {\r\n            value = newValue;\r\n            ViewManager.setAttribute(view, attrName, newValue);\r\n        }, true, true);\r\n        let unWatchView: Function = twoWayBinding && WatcherManager.watch(view, attrName, (newValue, oldValue) => {\r\n            if (value === newValue) {\r\n                return;\r\n            }\r\n            ViewManager.setAttribute(component, expression, newValue);\r\n        }, true);\r\n        let directive: IDirective = {\r\n            onDestroy: () => {\r\n                unWatchComponent();\r\n                unWatchView && unWatchView();\r\n            },\r\n        };\r\n        this.addDirective(component, directive);\r\n    }\r\n\r\n    private static createEventBinding(eventName: string, expression: string, component: IComponent, view) {\r\n        let hasAddListener = typeof view.addListener === 'function';\r\n        let hasEmitter = view.emitter instanceof EventEmitter;\r\n        if (!hasEmitter && !hasAddListener) {\r\n            return Utility.error(`Could not register event '@${eventName}=\"${expression}\"', the view is not an EventEmitter like object.`, view);\r\n        }\r\n        let func = ExpParser.parseNormalExp(expression) as Function;\r\n        let handler = (e) => {\r\n            func.call(component, e, view, window);\r\n        };\r\n        let directive = {\r\n            onDestroy: () => {\r\n                if (hasAddListener) {\r\n                    view.removeListener(eventName, handler);\r\n                }\r\n                else {\r\n                    view.emitter.removeListener(eventName, handler);\r\n                }\r\n            }\r\n        };\r\n        if (hasAddListener) {\r\n            view.addListener(eventName, handler);\r\n        }\r\n        else {\r\n            view.emitter.addListener(eventName, handler);\r\n        }\r\n        this.addDirective(component, directive);\r\n    }\r\n}\r\n\r\nexport interface IDirective {\r\n    onInit?(expression: string, component: IComponent, view: VirtualView, context);\r\n    onDestroy?();\r\n}\r\n\r\nexport function Directive(name: string, isTerminal?: boolean, priority?: number) {\r\n    return (ctor: Function) => {\r\n        BindingManager.registerDirective(name, ctor, isTerminal, priority);\r\n    }\r\n}\r\n\r\n/**\r\n * @Directive(\":repeat\")\r\n * class RepeatDirective {\r\n *     onInit(component, views) {\r\n *         \r\n *     }\r\n * }\r\n */","import { Utility } from './Utility';\r\nimport { Observable } from './Observable';\r\nimport { ObservableObject } from './ObservableObject';\r\nimport { VirtualView } from './ViewManager';\r\nimport { BindingManager } from './BindingManager';\r\nimport { WatcherManager } from './WatcherManager';\r\nimport { EventEmitter, Sprite } from 'canvas2djs';\r\n\r\nexport class ComponentManager {\r\n\r\n    private static componentModelSources: { [uid: string]: object } = {};\r\n    private static registeredComponentProperties: { [uid: string]: { [property: string]: Function | Function[] } } = {};\r\n    private static registeredComponentCtors: { [name: string]: Function } = {};\r\n    public static registeredBaseComponentCtors: { [name: string]: IBaseComponentCtor } = {};\r\n\r\n    public static registerComponent(name: string, ctor: Function, extendComponentName?: string) {\r\n        if (this.registeredComponentCtors[name] != null) {\r\n            Utility.warn(`Component \"${name}\" is override,`, ctor);\r\n        }\r\n        this.registeredComponentCtors[name] = ctor;\r\n        if (extendComponentName == null) {\r\n            return;\r\n        }\r\n        let properties = this.getRegisteredComponentPropertiesByName(extendComponentName);\r\n        if (properties == null) {\r\n            Utility.warn(`Component \"${extendComponentName}\" has not registered properties.`);\r\n        }\r\n        else {\r\n            this.registerComponentProperties(ctor, properties);\r\n        }\r\n    }\r\n\r\n    public static registerBaseComponent(name: string, ctor: IBaseComponentCtor, extendComponentName?: string) {\r\n        if (this.registeredBaseComponentCtors[name] != null) {\r\n            Utility.warn(`Component \"${name}\" is override,`, ctor);\r\n        }\r\n        this.registeredBaseComponentCtors[name] = ctor;\r\n        if (extendComponentName == null) {\r\n            return;\r\n        }\r\n        let properties = this.getRegisteredBaseComponentPropertiesByName(extendComponentName);\r\n        if (properties == null) {\r\n            Utility.warn(`Component \"${extendComponentName}\" has not registered properties.`);\r\n        }\r\n        else {\r\n            this.registerComponentProperties(ctor, properties);\r\n        }\r\n    }\r\n\r\n    public static registerComponentProperty(component: IComponent, property: string, type: Function | Function[]) {\r\n        let uid = Utility.getUid(component.constructor);\r\n        if (!this.registeredComponentProperties[uid]) {\r\n            this.registeredComponentProperties[uid] = {};\r\n        }\r\n        this.registeredComponentProperties[uid][property] = type;\r\n    }\r\n\r\n    public static registerComponentProperties(componentCtor: Function, properties: { [property: string]: Function | Function[] }) {\r\n        let uid = Utility.getUid(componentCtor);\r\n        if (!this.registeredComponentProperties[uid]) {\r\n            this.registeredComponentProperties[uid] = {};\r\n        }\r\n        this.registeredComponentProperties[uid] = {\r\n            ...this.registeredComponentProperties[uid],\r\n            ...properties\r\n        };\r\n    }\r\n\r\n    public static createComponentByName(name: string) {\r\n        let ctor: any = this.registeredComponentCtors[name];\r\n        if (!ctor) {\r\n            Utility.error(`Component \"${name}\" not found.`);\r\n        }\r\n\r\n        let instance = new ctor();\r\n        let modelSource = this.createComponentModelSource(instance);\r\n        let registeredProperties = this.getRegisteredComponentPropertiesByName(name);\r\n        if (registeredProperties) {\r\n            for (let property in registeredProperties) {\r\n                let value = instance[property];\r\n                Utility.createProxy(instance, property, modelSource);\r\n                ObservableObject.setProperty(modelSource, property, value);\r\n            }\r\n        }\r\n        if (typeof instance.onInit === \"function\") {\r\n            instance.onInit();\r\n        }\r\n\r\n        return instance;\r\n    }\r\n\r\n    public static createComponentByConstructor(ctor: Function) {\r\n        let instance = new (ctor as any)();\r\n        let modelSource = this.createComponentModelSource(instance);\r\n        let registeredProperties = this.getRegisteredComponentProperties(instance);\r\n        if (registeredProperties) {\r\n            for (let property in registeredProperties) {\r\n                let value = instance[property];\r\n                Utility.createProxy(instance, property, modelSource);\r\n                ObservableObject.setProperty(modelSource, property, value);\r\n            }\r\n        }\r\n        if (typeof instance.onInit === \"function\") {\r\n            instance.onInit();\r\n        }\r\n\r\n        return instance;\r\n    }\r\n\r\n    public static mountComponent(component: IComponent, view: VirtualView) {\r\n        if (typeof component.onBeforeMount === 'function') {\r\n            component.onBeforeMount(view);\r\n        }\r\n        BindingManager.createBinding(component, view);\r\n        if (typeof component.onAfterMounted === 'function') {\r\n            component.onAfterMounted();\r\n        }\r\n    }\r\n\r\n    public static getBaseComponentCtorByName(name: string) {\r\n        return this.registeredBaseComponentCtors[name];\r\n    }\r\n\r\n    public static getRegisteredBaseComponentPropertiesByName(name: string) {\r\n        let ctor = this.registeredBaseComponentCtors[name];\r\n        return ctor && this.registeredComponentProperties[Utility.getUid(ctor)];\r\n    }\r\n\r\n    public static getRegisteredComponentPropertiesByName(name: string) {\r\n        let ctor = this.registeredComponentCtors[name];\r\n        return ctor && this.registeredComponentProperties[Utility.getUid(ctor)];\r\n    }\r\n\r\n    public static getRegisteredComponentProperties(component: IComponent) {\r\n        let ctor = component.constructor;\r\n        return ctor && this.registeredComponentProperties[Utility.getUid(ctor)];\r\n    }\r\n\r\n    public static destroyComponent(component: IComponent) {\r\n        if (typeof component.onDestroy === 'function') {\r\n            component.onDestroy();\r\n        }\r\n        BindingManager.removeBinding(component);\r\n        WatcherManager.removeWatchers(component);\r\n\r\n        let uid = Utility.getUid(component);\r\n        let properties = this.getRegisteredComponentProperties(component);\r\n        let modelSource = this.componentModelSources[uid];\r\n        if (properties) {\r\n            for (let property in properties) {\r\n                if (modelSource) {\r\n                    delete modelSource[property];\r\n                }\r\n                delete component[property];\r\n            }\r\n        }\r\n        if (modelSource) {\r\n            Observable.clear(modelSource);\r\n        }\r\n        delete this.componentModelSources[uid];\r\n    }\r\n\r\n    private static createComponentModelSource(component: IComponent) {\r\n        let modelSource = Observable.toObservable({});\r\n        let uid = Utility.getUid(component);\r\n        this.componentModelSources[uid] = modelSource;\r\n        return modelSource;\r\n    }\r\n}\r\n\r\nexport function Component(name: string, extendComponentName?: string) {\r\n    return (componentCtor: Function) => {\r\n        ComponentManager.registerComponent(name, componentCtor, extendComponentName);\r\n    };\r\n}\r\n\r\nexport function Property(type: Function = String) {\r\n    return (component, property: string) => {\r\n        ComponentManager.registerComponentProperty(component, property, type);\r\n    };\r\n}\r\n\r\nexport function BaseComponent(name: string, extendComponentName?: string) {\r\n    return (componentCtor: IBaseComponentCtor) => {\r\n        ComponentManager.registerBaseComponent(name, componentCtor, extendComponentName);\r\n    }\r\n}\r\n\r\nexport interface IComponent {\r\n    emitter?: EventEmitter;\r\n    onInit?();\r\n    onBeforeMount?(views: VirtualView);\r\n    onAfterMounted?();\r\n    onDestroy?();\r\n}\r\n\r\nexport interface IBaseComponentCtor {\r\n    new(): Sprite<{}>;\r\n}\r\n\r\n/**\r\n * @Component(\"Button\")\r\n * class Button {\r\n *     @Property(String)\r\n *     label: string;\r\n * }\r\n */","/**\r\n     * The main path matching regexp utility.\r\n     *\r\n     * @type {RegExp}\r\n     */\r\nvar PATH_REGEXP = new RegExp([\r\n    // Match already escaped characters that would otherwise incorrectly appear\r\n    // in future matches. This allows the user to escape special characters that\r\n    // shouldn't be transformed.\r\n    '(\\\\\\\\.)',\r\n    // Match Express-style parameters and un-named parameters with a prefix\r\n    // and optional suffixes. Matches appear as:\r\n    //\r\n    // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\"]\r\n    // \"/route(\\\\d+)\" => [undefined, undefined, undefined, \"\\d+\", undefined]\r\n    '([\\\\/.])?(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^)])*)\\\\))?|\\\\(((?:\\\\\\\\.|[^)])*)\\\\))([+*?])?',\r\n    // Match regexp special characters that should always be escaped.\r\n    '([.+*?=^!:${}()[\\\\]|\\\\/])'\r\n].join('|'), 'g');\r\n\r\n/**\r\n * Escape the capturing group by escaping special characters and meaning.\r\n *\r\n * @param  {String} group\r\n * @return {String}\r\n */\r\nfunction escapeGroup(group) {\r\n    return group.replace(/([=!:$\\/()])/g, '\\\\$1');\r\n}\r\n\r\n/**\r\n * Attach the keys as a property of the regexp.\r\n *\r\n * @param  {RegExp} re\r\n * @param  {Array}  keys\r\n * @return {RegExp}\r\n */\r\nvar attachKeys = function (re, keys) {\r\n    re.keys = keys;\r\n\r\n    return re;\r\n};\r\n\r\n/**\r\n * Normalize the given path string, returning a regular expression.\r\n *\r\n * An empty array should be passed in, which will contain the placeholder key\r\n * names. For example `/user/:id` will then contain `[\"id\"]`.\r\n *\r\n * @param  {(String|RegExp|Array)} path\r\n * @param  {Array}                 keys\r\n * @param  {Object}                options\r\n * @return {RegExp}\r\n */\r\nexport function pathToRegexp(path, keys?, options?) {\r\n    if (keys && !Array.isArray(keys)) {\r\n        options = keys;\r\n        keys = null;\r\n    }\r\n\r\n    keys = keys || [];\r\n    options = options || {};\r\n\r\n    var strict = options.strict;\r\n    var end = options.end !== false;\r\n    var flags = options.sensitive ? '' : 'i';\r\n    var index = 0;\r\n\r\n    if (path instanceof RegExp) {\r\n        // Match all capturing groups of a regexp.\r\n        var groups = path.source.match(/\\((?!\\?)/g) || [];\r\n\r\n        // Map all the matches to their numeric keys and push into the keys.\r\n        keys.push.apply(keys, groups.map(function (match, index) {\r\n            return {\r\n                name: index,\r\n                delimiter: null,\r\n                optional: false,\r\n                repeat: false\r\n            };\r\n        }));\r\n\r\n        // Return the source back to the user.\r\n        return attachKeys(path, keys);\r\n    }\r\n\r\n    if (Array.isArray(path)) {\r\n        // Map array parts into regexps and return their source. We also pass\r\n        // the same keys and options instance into every generation to get\r\n        // consistent matching groups before we join the sources together.\r\n        path = path.map(function (value) {\r\n            return pathToRegexp(value, keys, options).source;\r\n        });\r\n\r\n        // Generate a new regexp instance by joining all the parts together.\r\n        return attachKeys(new RegExp('(?:' + path.join('|') + ')', flags), keys);\r\n    }\r\n\r\n    // Alter the path string into a usable regexp.\r\n    path = path.replace(PATH_REGEXP, function (match, escaped, prefix, key, capture, group, suffix, escape) {\r\n        // Avoiding re-escaping escaped characters.\r\n        if (escaped) {\r\n            return escaped;\r\n        }\r\n\r\n        // Escape regexp special characters.\r\n        if (escape) {\r\n            return '\\\\' + escape;\r\n        }\r\n\r\n        var repeat = suffix === '+' || suffix === '*';\r\n        var optional = suffix === '?' || suffix === '*';\r\n\r\n        keys.push({\r\n            name: key || index++,\r\n            delimiter: prefix || '/',\r\n            optional: optional,\r\n            repeat: repeat\r\n        });\r\n\r\n        // Escape the prefix character.\r\n        prefix = prefix ? '\\\\' + prefix : '';\r\n\r\n        // Match using the custom capturing group, or fallback to capturing\r\n        // everything up to the next slash (or next period if the param was\r\n        // prefixed with a period).\r\n        capture = escapeGroup(capture || group || '[^' + (prefix || '\\\\/') + ']+?');\r\n\r\n        // Allow parameters to be repeated more than once.\r\n        if (repeat) {\r\n            capture = capture + '(?:' + prefix + capture + ')*';\r\n        }\r\n\r\n        // Allow a parameter to be optional.\r\n        if (optional) {\r\n            return '(?:' + prefix + '(' + capture + '))?';\r\n        }\r\n\r\n        // Basic parameter support.\r\n        return prefix + '(' + capture + ')';\r\n    });\r\n\r\n    // Check whether the path ends in a slash as it alters some match behaviour.\r\n    var endsWithSlash = path[path.length - 1] === '/';\r\n\r\n    // In non-strict mode we allow an optional trailing slash in the match. If\r\n    // the path to match already ended with a slash, we need to remove it for\r\n    // consistency. The slash is only valid at the very end of a path match, not\r\n    // anywhere in the middle. This is important for non-ending mode, otherwise\r\n    // \"/test/\" will match \"/test//route\".\r\n    if (!strict) {\r\n        path = (endsWithSlash ? path.slice(0, -2) : path) + '(?:\\\\/(?=$))?';\r\n    }\r\n\r\n    // In non-ending mode, we need prompt the capturing groups to match as much\r\n    // as possible by using a positive lookahead for the end or next path segment.\r\n    if (!end) {\r\n        path += strict && endsWithSlash ? '' : '(?=\\\\/|$)';\r\n    }\r\n\r\n    return attachKeys(new RegExp('^' + path + (end ? '$' : ''), flags), keys);\r\n};","import { Texture, Sound, WebAudio, HTMLAudio } from 'canvas2djs';\r\nimport { Request } from './Request';\r\nimport { TemplateManager } from './TemplateManager';\r\nimport { Utility } from './Utility';\r\n\r\nexport enum ResourceType {\r\n    Image,\r\n    Altas,\r\n    Json,\r\n    Audio,\r\n    HtmlTemplate,\r\n    JsonTemplate,\r\n}\r\n\r\nexport type Resource = {\r\n    url: string;\r\n    type: ResourceType;\r\n    channel?: number; // for ResourceType.Audio\r\n    retryTimes?: number;\r\n};\r\n\r\nexport class Loader {\r\n\r\n    private static audioChannel = 1;\r\n    private static retryTimes = 1;\r\n    private static maxLoading = 5;\r\n\r\n    private static basePathMap: { [key: string]: string } = {};\r\n    private static altasMap: { [url: string]: { [name: string]: Texture } } = {};\r\n    private static loadedResources: { [id: string]: any } = {};\r\n\r\n    public static getRetryTimes(res: Resource) {\r\n        return res.retryTimes == null ? this.retryTimes : res.retryTimes;\r\n    }\r\n\r\n    public static setRetryTimes(times: number) {\r\n        this.retryTimes = times;\r\n    }\r\n\r\n    public static setAudioChannel(channel: number) {\r\n        this.audioChannel = channel;\r\n    }\r\n\r\n    public static setMaxLoading(maxLoading: number) {\r\n        this.maxLoading = Math.max(1, maxLoading);\r\n    }\r\n\r\n    public static clear() {\r\n        this.loadedResources = {};\r\n    }\r\n\r\n    public static getRes(url: string, version?: string) {\r\n        let key = version ? url + '?v=' + version : url;\r\n        return this.loadedResources[key];\r\n    }\r\n\r\n    public static load(\r\n        resources: Resource[],\r\n        version: string,\r\n        onCompleted: Function,\r\n        onProgress?: (percent: number) => any,\r\n        onError?: (type: ResourceType, url: string, version: string) => any\r\n    ) {\r\n        let loaded = 0;\r\n        let result = [];\r\n        let stepLoaded: number;\r\n        let loadCount: number;\r\n\r\n        let logAndReportError = (type: ResourceType, url: string, version: string) => {\r\n            Utility.warn(`Resource [${ResourceType[type]}]\"${url}\"(version=${version}) loading failed.`);\r\n            onError && onError(type, url, version);\r\n        }\r\n        let loadNext = () => {\r\n            loadCount = Math.min(this.maxLoading, resources.length - loaded);\r\n            stepLoaded = 0;\r\n            for (let i = loaded, l = loaded + loadCount; i < l; i++) {\r\n                let res = resources[i];\r\n                let retryTimes = this.getRetryTimes(res);\r\n                switch (res.type) {\r\n                    case ResourceType.Altas:\r\n                        this.loadAltas(res.url, version, retryTimes, (success, altas) => {\r\n                            if (success) {\r\n                                result[i] = altas;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.Altas, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        }, null, onError);\r\n                        break;\r\n                    case ResourceType.Image:\r\n                        this.loadImage(res.url, res.url, version, retryTimes, (success, img) => {\r\n                            if (success) {\r\n                                result[i] = img;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.Image, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        });\r\n                        break;\r\n                    case ResourceType.Json:\r\n                        this.loadJson(res.url, version, retryTimes, (success, resp) => {\r\n                            if (success) {\r\n                                result[i] = resp;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.Json, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        });\r\n                        break;\r\n                    case ResourceType.Audio:\r\n                        this.loadAudio(res.url, version, res.channel == null ? this.audioChannel : res.channel, retryTimes, (success, audios) => {\r\n                            if (success) {\r\n                                result[i] = audios;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.Audio, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        });\r\n                        break;\r\n                    case ResourceType.HtmlTemplate:\r\n                        this.loadHtmlTemplate(res.url, version, retryTimes, (success, html) => {\r\n                            if (success) {\r\n                                result[i] = html;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.HtmlTemplate, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        });\r\n                        break;\r\n                    case ResourceType.JsonTemplate:\r\n                        this.loadJsonTemplate(res.url, version, retryTimes, (success, json) => {\r\n                            if (success) {\r\n                                result[i] = json;\r\n                            }\r\n                            else {\r\n                                logAndReportError(ResourceType.JsonTemplate, res.url, version);\r\n                            }\r\n                            checkComplete();\r\n                        });\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        loadNext();\r\n\r\n        function checkComplete() {\r\n            loaded += 1;\r\n            onProgress && onProgress(loaded / resources.length);\r\n            // console.log(result);\r\n            if (loaded === resources.length) {\r\n                onCompleted(result);\r\n            }\r\n            else if (++stepLoaded === loadCount) {\r\n                loadNext();\r\n            }\r\n        }\r\n    }\r\n\r\n    public static loadAltas(url: string, version: string, retryTimes: number, onComplete: Function, onProgress?: (percent: number) => any, onError?: Function) {\r\n        let requestUrl = url + '?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n\r\n        this.loadJson(url, version, 1, (success: boolean, data: any) => {\r\n            if (!success) {\r\n                if (retryTimes > 0) {\r\n                    return this.loadAltas(url, version, retryTimes - 1, onComplete, onProgress, onError);\r\n                }\r\n                if (onError) {\r\n                    onError(ResourceType.Altas, url, version);\r\n                }\r\n                return onComplete(false);\r\n            }\r\n            let images = data.meta.image.split(\",\");\r\n            let basePath = this.getBasePath(url);\r\n            let namePrefix = this.getBasePath(data.meta.prefix);\r\n            let imgs: HTMLImageElement[] = [];\r\n            let altas: { [name: string]: Texture } = this.altasMap[url] = {};\r\n            let loaded = 0;\r\n\r\n            let onAllDone = () => {\r\n                for (let name in data.frames) {\r\n                    let obj = data.frames[name];\r\n                    let img = imgs[obj.frame.idx || 0];\r\n                    let sourceRect = { x: obj.frame.x, y: obj.frame.y, width: obj.frame.w, height: obj.frame.h };\r\n                    let textureRect = { x: obj.spriteSourceSize.x, y: obj.spriteSourceSize.y, width: obj.sourceSize.w, height: obj.sourceSize.h };\r\n                    let texture = Texture.create(img, sourceRect, textureRect);\r\n                    Texture.cacheAs(namePrefix + name, texture);\r\n                    altas[name] = texture;\r\n                }\r\n                this.loadedResources[requestUrl] = this.loadedResources[url] = altas;\r\n                onComplete(true, altas);\r\n            };\r\n\r\n            for (let name: string, i = 0; name = images[i]; i++) {\r\n                this.loadImage(name, basePath + name, version, this.retryTimes, (success, img) => {\r\n                    if (!success && onError) {\r\n                        onError(ResourceType.Image, basePath + name, version);\r\n                    }\r\n\r\n                    imgs.push(img);\r\n                    loaded += 1;\r\n                    onProgress && onProgress(loaded / images.length);\r\n                    if (loaded === images.length) {\r\n                        onAllDone();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public static loadImage(name: string, url: string, version: string, retryTimes: number, onComplete: (loaded: boolean, img: HTMLImageElement) => any) {\r\n        let requestUrl = url + '?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n\r\n        let img = new Image();\r\n        img.onload = () => {\r\n            let texture = Texture.create(img);\r\n            Texture.cacheAs(name, texture);\r\n            Texture.cacheAs(url, texture);\r\n            this.loadedResources[requestUrl] = this.loadedResources[url] = img;\r\n            onComplete(true, img);\r\n            img = null;\r\n        };\r\n        img.onerror = () => {\r\n            if (retryTimes > 0) {\r\n                this.loadImage(name, url, version, retryTimes - 1, onComplete);\r\n            }\r\n            else {\r\n                onComplete(false, img);\r\n            }\r\n            img = null;\r\n        };\r\n        img.crossOrigin = 'anonymous';\r\n        img.src = requestUrl;\r\n    }\r\n\r\n    public static loadAudio(url: string, version: string, channel: number, retryTimes: number, onComplete: (loaded: boolean, res: (WebAudio | HTMLAudio)[]) => any) {\r\n        let requestUrl = url + '?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n\r\n        let basePath = this.getBasePath(url);\r\n        let filePath = url.slice(basePath.length);\r\n        let ext = filePath.match(/\\.[^.]+$/)[0];\r\n        let name = filePath.slice(0, filePath.length - ext.length);\r\n        Sound.ext = ext as any;\r\n        Sound.load(basePath, name, (loaded) => {\r\n            let audioes = Sound.getAllAudioes(name);\r\n            if (loaded) {\r\n                this.loadedResources[requestUrl] = this.loadedResources[url] = audioes;\r\n                onComplete(loaded, audioes);\r\n            }\r\n            else if (retryTimes > 0) {\r\n                this.loadAudio(url, version, channel, retryTimes - 1, onComplete);\r\n            }\r\n            else {\r\n                onComplete(loaded, audioes);\r\n            }\r\n        }, channel, version);\r\n    }\r\n\r\n    public static loadJson(url: string, version: string, retryTimes: number, onComplete: Function) {\r\n        let requestUrl = url + '?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n        let node = document.getElementById(url);\r\n        if (node && node.innerHTML) {\r\n            let html = node.innerHTML;\r\n            try {\r\n                let json = JSON.parse(html);\r\n                this.loadedResources[requestUrl] = json;\r\n                TemplateManager.registerJsonTemplate(url, json);\r\n                onComplete(true, json);\r\n            } catch (e) {\r\n                onComplete(false, null);\r\n            }\r\n            return;\r\n        }\r\n\r\n        Request.getJson(requestUrl, (res) => {\r\n            this.loadedResources[requestUrl] = this.loadedResources[url] = res;\r\n            onComplete(true, res);\r\n        }, () => {\r\n            if (retryTimes > 0) {\r\n                this.loadJson(url, version, retryTimes - 1, onComplete);\r\n            }\r\n            else {\r\n                onComplete(false, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static loadHtmlTemplate(url: string, version: string, retryTimes: number, onComplete: Function) {\r\n        let requestUrl = url + '.html?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n        let node = document.getElementById(url);\r\n        if (node && node.innerHTML) {\r\n            let html = node.innerHTML;\r\n            this.loadedResources[requestUrl] = html;\r\n            TemplateManager.registerHtmlTemplate(url, html);\r\n            return onComplete(true, html);\r\n        }\r\n\r\n        Request.get(requestUrl, (html) => {\r\n            this.loadedResources[requestUrl] = this.loadedResources[url] = html;\r\n            TemplateManager.registerHtmlTemplate(url, html);\r\n            onComplete(true, html);\r\n        }, () => {\r\n            if (retryTimes > 0) {\r\n                this.loadHtmlTemplate(url, version, retryTimes - 1, onComplete);\r\n            }\r\n            else {\r\n                onComplete(false, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static loadJsonTemplate(url: string, version: string, retryTimes: number, onComplete: Function) {\r\n        let requestUrl = url + '.json?v=' + version;\r\n        if (this.loadedResources[requestUrl]) {\r\n            return onComplete(true, this.loadedResources[requestUrl]);\r\n        }\r\n        Request.getJson(requestUrl, (json) => {\r\n            this.loadedResources[requestUrl] = this.loadedResources[url] = json;\r\n            TemplateManager.registerJsonTemplate(url, json);\r\n            onComplete(true, json);\r\n        }, () => {\r\n            if (retryTimes > 0) {\r\n                this.loadJsonTemplate(url, version, retryTimes - 1, onComplete);\r\n            }\r\n            else {\r\n                onComplete(false, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static getAltas(url: string) {\r\n        return this.altasMap[url];\r\n    }\r\n\r\n    private static getBasePath(url: string) {\r\n        if (!this.basePathMap[url]) {\r\n            let split = url.indexOf(\"/\") >= 0 ? \"/\" : \"\\\\\";\r\n            let idx = url.lastIndexOf(split);\r\n            this.basePathMap[url] = idx >= 0 ? url.substr(0, idx + 1) : \"\";\r\n        }\r\n        return this.basePathMap[url];\r\n    }\r\n}\r\n","import { StageProps, Stage, Sprite, SpriteProps } from 'canvas2djs';\r\nimport { pathToRegexp } from './PathToRegexp';\r\nimport { IComponent, ComponentManager } from './ComponentManager';\r\nimport { Resource, Loader, ResourceType } from './Loader';\r\nimport { ViewManager } from './ViewManager';\r\nimport { TemplateManager } from './TemplateManager';\r\nimport { Utility } from './Utility';\r\n\r\nconst ContainerProps: SpriteProps = { left: 0, right: 0, top: 0, bottom: 0 };\r\n\r\nexport class Application {\r\n    private onLoadStart: (loadingSceneComponent: any, componentName: string) => any;\r\n    private onLoaded: (loadingSceneComponent: any, componentName: string, next: Function) => any;\r\n    private onLoadingProgress: (loadingSceneComponent: any, componentName: string, loadedPercent: number) => any;\r\n    private onLoadingError: (loadingSceneComponent: any, type: ResourceType, url: string, version: string) => any;\r\n\r\n    private version: string;\r\n    private loadedComponents: string[] = [];\r\n\r\n    private stage: Stage;\r\n\r\n    private indexUrl: string;\r\n    private routers: ParsedRouter[] = [];\r\n    private currState: RouterState;\r\n    private lastState: RouterState;\r\n    private currRouter: ParsedRouter;\r\n\r\n    private navigateByLocationApi: boolean = true;\r\n\r\n    private currComponentName: string;\r\n    private currComponent: IComponentWithRouter;\r\n    private currScene: Sprite<{}> = new Sprite(ContainerProps);\r\n\r\n    private isLoadingSceneReady: boolean;\r\n    private loadingSceneComponent: IComponent;\r\n    private loadingScene: Sprite<{}> = new Sprite(ContainerProps);\r\n    private loadingSceneResources: Resource[];\r\n    private loadingSceneTemplate: string;\r\n\r\n    public getStage() {\r\n        return this.stage;\r\n    }\r\n\r\n    public setVersion(version: string) {\r\n        this.version = version;\r\n    }\r\n\r\n    public setNavigateByLocationApi(navigateByLocationApi: boolean) {\r\n        this.navigateByLocationApi = !!navigateByLocationApi;\r\n    }\r\n\r\n    public getVersion() {\r\n        return this.version;\r\n    }\r\n\r\n    public createLoadingScene(options: LoadingSceneOptions) {\r\n        this.loadingSceneResources = options.resources;\r\n        this.loadingSceneTemplate = options.template;\r\n        this.onLoadingError = options.onLoadingError;\r\n        this.onLoadingProgress = options.onLoadingProgress;\r\n        this.onLoaded = options.onLoaded || ((a, b, next) => next());\r\n        this.onLoadStart = options.onLoadStart;\r\n        this.loadingSceneComponent = ComponentManager.createComponentByName(options.component);\r\n    }\r\n\r\n    public createStage(stageProps: StageProps) {\r\n        this.stage = new Stage(\r\n            stageProps.canvas,\r\n            stageProps.width,\r\n            stageProps.height,\r\n            stageProps.scaleMode,\r\n            !!stageProps.autoAdjustCanvasSize,\r\n            stageProps.orientation\r\n        );\r\n        this.stage.mouseEnabled = !!stageProps.mouseEnabled;\r\n        this.stage.touchEnabled = !!stageProps.touchEnabled;\r\n    }\r\n\r\n    public setIndexUrl(indexUrl: string) {\r\n        this.indexUrl = indexUrl;\r\n    }\r\n\r\n    public navigate(url: string, replaceState?: boolean) {\r\n        if (this.navigateByLocationApi) {\r\n            let navigateUrl = '#' + url;\r\n            if (replaceState) {\r\n                location.replace(navigateUrl);\r\n            }\r\n            else {\r\n                location.href = navigateUrl;\r\n            }\r\n        }\r\n        else {\r\n            this.onUrlChanged(url);\r\n        }\r\n    }\r\n\r\n    public registerRouter(routerOptions: RouterOptions) {\r\n        for (let path in routerOptions) {\r\n            let options = routerOptions[path];\r\n            let reg = pathToRegexp(path);\r\n            let params = reg.keys.map(key => key.name);\r\n\r\n            delete reg.keys;\r\n\r\n            this.routers.push({\r\n                ...options,\r\n                reg,\r\n                path,\r\n                params,\r\n            });\r\n        }\r\n    }\r\n\r\n    public start(url = location.hash.slice(1)) {\r\n        if (this.version == null) {\r\n            Utility.error(`Application version required.`);\r\n        }\r\n        this.registerHashChangeEvent();\r\n        this.initLoadingScene();\r\n        this.onUrlChanged(url);\r\n    }\r\n\r\n    public parseState(url: string): { state: RouterState; router: ParsedRouter } {\r\n        var saveParam = (param, j) => {\r\n            params[param] = result[j + 1];\r\n        };\r\n        var result: RegExpExecArray;\r\n        var params: { [name: string]: any };\r\n\r\n        for (let i = 0; i < this.routers.length; i++) {\r\n            let router = this.routers[i];\r\n\r\n            if (router.reg.test(url)) {\r\n                result = router.reg.exec(url);\r\n                params = {};\r\n                for (let j = 0, n = router.params.length; j < n; j++) {\r\n                    params[router.params[j]] = result[j + 1];\r\n                }\r\n                return {\r\n                    state: {\r\n                        url,\r\n                        path: router.path,\r\n                        params,\r\n                    },\r\n                    router,\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    public destroy() {\r\n        this.loadingSceneComponent && ComponentManager.destroyComponent(this.loadingSceneComponent);\r\n        this.currComponent && ComponentManager.destroyComponent(this.currComponent);\r\n        this.stage.release();\r\n        this.loadingScene = this.loadingSceneComponent = null;\r\n        this.currRouter = this.currScene = this.currComponent = null;\r\n        this.stage = null;\r\n    }\r\n\r\n    private onUrlChanged(url: string) {\r\n        var result: { state: RouterState; router: ParsedRouter };\r\n\r\n        if (!url || !(result = this.parseState(url))) {\r\n            if (this.indexUrl === url) {\r\n                Utility.error(`Invalid index url \"${this.indexUrl}\"`);\r\n            }\r\n            return this.navigate(this.indexUrl, true);\r\n        }\r\n\r\n        var { state, router } = result;\r\n\r\n        if (this.currRouter && this.currRouter.onLeave) {\r\n            this.currRouter.onLeave(state);\r\n        }\r\n        if (router.onEnter) {\r\n            router.onEnter(state, () => {\r\n                this.replaceState(state, router);\r\n            });\r\n        }\r\n        else {\r\n            this.replaceState(state, router);\r\n        }\r\n    }\r\n\r\n    private replaceState(state: RouterState, router: ParsedRouter) {\r\n        this.lastState = this.currState;\r\n        this.currState = state;\r\n\r\n        if (this.currComponent) {\r\n            if (this.currComponentName === router.component) {\r\n                if (typeof this.currComponent.onEnter === 'function') {\r\n                    this.currComponent.onEnter(state, this.lastState);\r\n                }\r\n                return;\r\n            }\r\n            ComponentManager.destroyComponent(this.currComponent);\r\n            this.currComponent = null;\r\n            if (this.currScene.children) {\r\n                for (let i = 0, child: Sprite<{}>; child = this.currScene.children[i]; i++) {\r\n                    child.release(true);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.loadComponentResource(router);\r\n    }\r\n\r\n    private loadComponentResource(router: ParsedRouter) {\r\n        this.currRouter = router;\r\n\r\n        if (!this.isLoadingSceneReady) {\r\n            return;\r\n        }\r\n        if (this.loadedComponents.indexOf(router.component) < 0) {\r\n            this.setLoadingState(true);\r\n\r\n            this.onLoadStart && this.onLoadStart(this.loadingSceneComponent, router.component);\r\n\r\n            Loader.load(router.resources, this.version, () => {\r\n                Utility.addEnsureUniqueArrayItem(router.component, this.loadedComponents);\r\n                if (this.currRouter === router) {\r\n                    this.createComponent(router);\r\n                }\r\n            }, (loadedPercent: number) => {\r\n                if (this.currRouter === router && this.onLoadingProgress) {\r\n                    this.onLoadingProgress(this.loadingSceneComponent, router.component, loadedPercent);\r\n                }\r\n            }, (type: ResourceType, url: string, version: string) => {\r\n                this.onLoadingError && this.onLoadingError(this.loadingSceneComponent, type, url, version);\r\n            });\r\n        }\r\n        else {\r\n            this.createComponent(router);\r\n        }\r\n    }\r\n\r\n    private createComponent(router: ParsedRouter) {\r\n        let view = ViewManager.createView(TemplateManager.getTemplateByName(router.template));\r\n        let component: IComponentWithRouter = ComponentManager.createComponentByName(router.component);\r\n\r\n        ComponentManager.mountComponent(component, view);\r\n\r\n        if (typeof component.onEnter === 'function') {\r\n            component.onEnter(this.currState, this.lastState);\r\n        }\r\n\r\n        this.currComponentName = router.component;\r\n        this.currComponent = component;\r\n        this.currScene.addChild(view.sprite);\r\n        this.setLoadingState(false);\r\n    }\r\n\r\n    private initLoadingScene() {\r\n        Loader.load(this.loadingSceneResources, this.version, () => {\r\n            let view = ViewManager.createView(TemplateManager.getTemplateByName(this.loadingSceneTemplate));\r\n\r\n            this.loadingScene.addChild(view.sprite);\r\n            ComponentManager.mountComponent(this.loadingSceneComponent, view);\r\n            this.isLoadingSceneReady = true;\r\n\r\n            if (this.currRouter) {\r\n                this.loadComponentResource(this.currRouter);\r\n            }\r\n        }, null, (type: ResourceType, url: string, version: string) => {\r\n            this.onLoadingError && this.onLoadingError(this.loadingSceneComponent, type, url, version);\r\n        });\r\n    }\r\n\r\n    private setLoadingState(isLoading: boolean) {\r\n        if (isLoading) {\r\n            if (this.currScene.parent) {\r\n                this.stage.removeChild(this.currScene);\r\n            }\r\n            if (!this.loadingScene.parent) {\r\n                this.stage.addChild(this.loadingScene, 0);\r\n            }\r\n        }\r\n        else {\r\n            if (!this.currScene.parent) {\r\n                this.stage.addChild(this.currScene, 0);\r\n            }\r\n            if (this.loadingScene.parent) {\r\n                this.stage.removeChild(this.loadingScene);\r\n            }\r\n        }\r\n    }\r\n\r\n    private registerHashChangeEvent() {\r\n        window.addEventListener(\"hashchange\", () => {\r\n            this.onUrlChanged(location.hash.slice(1));\r\n        });\r\n    }\r\n}\r\n\r\nexport type RouterOptions = {\r\n    [name: string]: {\r\n        component: string;\r\n        resources: Resource[];\r\n        template: string;\r\n        onEnter?(state: RouterState, next: Function);\r\n        onLeave?(nextState: RouterState);\r\n    }\r\n}\r\n\r\nexport type RouterState = {\r\n    url: string;\r\n    path: string;\r\n    params: { [name: string]: any };\r\n}\r\n\r\nexport type LoadingSceneOptions = {\r\n    template: string;\r\n    component: string;\r\n    resources: Resource[];\r\n    onLoadStart?(loadingSceneComponent, componentName: string);\r\n    onLoadingProgress?(loadingSceneComponent, componentName: string, loadedPercent: number);\r\n    onLoaded?(loadingSceneComponent, componentName: string, next: Function);\r\n    onLoadingError?(loadingSceneComponent, type: ResourceType, url: string, version: string);\r\n}\r\n\r\nexport interface IComponentWithRouter extends IComponent {\r\n    onEnter?(currState: RouterState, lastState: RouterState);\r\n}\r\n\r\nexport type ParsedRouter = {\r\n    path: string;\r\n    reg: RegExp;\r\n    params: string[];\r\n    component: string;\r\n    resources: Resource[];\r\n    template: string;\r\n    onEnter?(state: RouterState, next: Function);\r\n    onLeave?(nextState: RouterState);\r\n}","import { Action, Tween } from 'canvas2djs';\r\n/**\r\n * 需要记录的历史速度的最大次数。\r\n */\r\nconst MAX_VELOCITY_COUNT = 4;\r\n/**\r\n * 记录的历史速度的权重列表。\r\n */\r\nconst VELOCITY_WEIGHTS: number[] = [1, 1.33, 1.66, 2];\r\n/**\r\n * 当前速度所占的权重。\r\n */\r\nconst CURRENT_VELOCITY_WEIGHT = 2.33;\r\n/**\r\n * 最小的改变速度，解决浮点数精度问题。\r\n */\r\nconst MINIMUM_VELOCITY = 0.02;\r\n/**\r\n * 当容器自动滚动时要应用的摩擦系数\r\n */\r\nconst FRICTION = 0.998;\r\n/**\r\n * 当容器自动滚动时并且滚动位置超出容器范围时要额外应用的摩擦系数\r\n */\r\nconst EXTRA_FRICTION = 0.95;\r\n/**\r\n * 摩擦系数的自然对数\r\n */\r\nconst FRICTION_LOG = Math.log(FRICTION);\r\n\r\nexport class TouchScroll {\r\n\r\n    private offsetPos: number = 0;\r\n    private currentPos: number = 0;\r\n    private previousPos: number = 0;\r\n    private maxScrollPos: number = 0;\r\n    private previousTime: number = 0;\r\n    private velocity: number = 0;\r\n    private previousVelocity: number[] = [];\r\n\r\n    private timerId: number;\r\n\r\n    private _currScrollPos: number = 0;\r\n    private get currScrollPos() {\r\n        return this._currScrollPos;\r\n    }\r\n\r\n    private action: Action;\r\n\r\n    public bounce: boolean = true;\r\n    public scrollFactor: number = 1;\r\n\r\n    private set currScrollPos(value: number) {\r\n        this._currScrollPos = value;\r\n        if (this.onUpdate) {\r\n            this.onUpdate(this._currScrollPos);\r\n        }\r\n    }\r\n\r\n    constructor(\r\n        private onUpdate: (scrollPos: number) => any,\r\n        private onEnded: () => any\r\n    ) {\r\n\r\n    }\r\n\r\n    public start(position: number) {\r\n        this.stop();\r\n        this.offsetPos = position;\r\n        this.currentPos = this.previousPos = position;\r\n        this.previousTime = Date.now();\r\n        this.previousVelocity.length = 0;\r\n        this.startTick();\r\n    }\r\n\r\n    public stop() {\r\n        if (this.action) {\r\n            this.action.stop();\r\n            this.action = null;\r\n        }\r\n        this.velocity = 0;\r\n        this.stopTick();\r\n    }\r\n\r\n    public release() {\r\n        this.stop();\r\n        this.onUpdate = this.onEnded = null;\r\n    }\r\n\r\n    public update(touchPos: number, maxScrollPos: number, scrollValue: number) {\r\n        maxScrollPos = Math.max(0, maxScrollPos);\r\n        this.currentPos = touchPos;\r\n        this.maxScrollPos = maxScrollPos;\r\n\r\n        let disMove = this.offsetPos - touchPos;\r\n        let scrollPos = disMove + scrollValue;\r\n\r\n        this.offsetPos = touchPos;\r\n\r\n        if (scrollPos < 0) {\r\n            if (!this.bounce) {\r\n                scrollPos = 0;\r\n            }\r\n            else {\r\n                scrollPos -= disMove * 0.5;\r\n            }\r\n        }\r\n        if (scrollPos > maxScrollPos) {\r\n            if (!this.bounce) {\r\n                scrollPos = maxScrollPos;\r\n            }\r\n            else {\r\n                scrollPos -= disMove * 0.5;\r\n            }\r\n        }\r\n        this.currScrollPos = scrollPos;\r\n    }\r\n\r\n    public finish(currScrollPos: number, maxScrollPos: number) {\r\n        this.stopTick();\r\n\r\n        let sum = this.velocity * CURRENT_VELOCITY_WEIGHT;\r\n        let prevVelocityX = this.previousVelocity;\r\n        let length = this.previousVelocity.length;\r\n        let totalWeight = CURRENT_VELOCITY_WEIGHT;\r\n\r\n        for (let i = 0; i < length; i++) {\r\n            let weight = VELOCITY_WEIGHTS[i];\r\n            sum += prevVelocityX[i] * weight;\r\n            totalWeight += weight;\r\n        }\r\n\r\n        let pixelsPerMS = sum / totalWeight;\r\n        let absPixelsPerMS = Math.abs(pixelsPerMS);\r\n        let duration = 0;\r\n        let posTo = 0;\r\n\r\n        if (absPixelsPerMS > MINIMUM_VELOCITY) {\r\n            posTo = currScrollPos + (pixelsPerMS - MINIMUM_VELOCITY) / FRICTION_LOG * 2 * this.scrollFactor;\r\n            if (posTo < 0 || posTo > maxScrollPos) {\r\n                posTo = currScrollPos;\r\n                while (Math.abs(pixelsPerMS) > MINIMUM_VELOCITY) {\r\n                    posTo -= pixelsPerMS;\r\n                    if (posTo < 0 || posTo > maxScrollPos) {\r\n                        pixelsPerMS *= FRICTION * EXTRA_FRICTION;\r\n                    }\r\n                    else {\r\n                        pixelsPerMS *= FRICTION;\r\n                    }\r\n                    duration += 1;\r\n                }\r\n            }\r\n            else {\r\n                duration = Math.log(MINIMUM_VELOCITY / absPixelsPerMS) / FRICTION_LOG;\r\n            }\r\n        }\r\n        else {\r\n            posTo = currScrollPos;\r\n        }\r\n\r\n        if (duration > 0) {\r\n            if (!this.bounce) {\r\n                if (posTo < 0) {\r\n                    posTo = 0;\r\n                }\r\n                else if (posTo > maxScrollPos) {\r\n                    posTo = maxScrollPos;\r\n                }\r\n            }\r\n            this.throwTo(posTo, duration);\r\n        }\r\n        else {\r\n            this.finishScrolling();\r\n        }\r\n    }\r\n\r\n    private onTick() {\r\n        let now = Date.now();\r\n        let timeOffset = now - this.previousTime;\r\n        if (timeOffset > 10) {\r\n            let previousVelocity = this.previousVelocity;\r\n            if (previousVelocity.length >= MAX_VELOCITY_COUNT) {\r\n                previousVelocity.shift();\r\n            }\r\n            this.velocity = (this.currentPos - this.previousPos) / timeOffset;\r\n            previousVelocity.push(this.velocity);\r\n            this.previousTime = now;\r\n            this.previousPos = this.currentPos;\r\n        }\r\n        this.startTick();\r\n    }\r\n\r\n    private throwTo(posTo: number, duration: number) {\r\n        let currScrollPos = this._currScrollPos;\r\n        if (currScrollPos === posTo) {\r\n            return this.onEnded();\r\n        }\r\n        if (this.action) {\r\n            this.action.stop();\r\n        }\r\n\r\n        this.action = new Action(this).to({\r\n            currScrollPos: {\r\n                dest: posTo,\r\n                easing: easeOut\r\n            }\r\n        }, duration / 1000).then(() => {\r\n            this.action = null;\r\n            this.finishScrolling();\r\n        }).start();\r\n    }\r\n\r\n    private finishScrolling() {\r\n        let posTo = this._currScrollPos;\r\n        let maxScrollPos = this.maxScrollPos;\r\n        if (posTo < 0) {\r\n            posTo = 0\r\n        }\r\n        else if (posTo > maxScrollPos) {\r\n            posTo = maxScrollPos;\r\n        }\r\n        this.throwTo(posTo, 300);\r\n    }\r\n\r\n    private startTick() {\r\n        this.stopTick();\r\n        this.timerId = setTimeout(() => this.onTick());\r\n    }\r\n\r\n    private stopTick() {\r\n        clearTimeout(this.timerId);\r\n        this.timerId = null;\r\n    }\r\n}\r\n\r\nfunction easeOut(ratio: number): number {\r\n    let invRatio: number = ratio - 1.0;\r\n    return invRatio * invRatio * invRatio + 1;\r\n}","import { ComponentManager } from './ComponentManager';\r\nimport { Sprite, TextLabel, BMFontLabel, Texture } from 'canvas2djs';\r\nimport { ScrollView } from './ScrollView';\r\nimport { AutoLayoutView } from './AutoLayoutView';\r\nimport { AutoResizeView } from './AutoResizeView';\r\n\r\nvar SpriteProperties = {\r\n    x: Number,\r\n    y: Number,\r\n    width: Number,\r\n    height: Number,\r\n    scaleX: Number,\r\n    scaleY: Number,\r\n    originX: Number,\r\n    originY: Number,\r\n    bgColor: [String, Number],\r\n    radius: Number,\r\n    borderWidth: Number,\r\n    borderColor: [String, Number],\r\n    texture: String,\r\n    rotation: Number,\r\n    opacity: Number,\r\n    visible: Boolean,\r\n    alignX: Number,\r\n    alignY: Number,\r\n    flippedX: Boolean,\r\n    flippedY: Boolean,\r\n    clipOverflow: Boolean,\r\n    top: Number,\r\n    right: Number,\r\n    bottom: Number,\r\n    left: Number,\r\n    percentWidth: Number,\r\n    percentHeight: Number,\r\n    grid: Array,\r\n    sourceX: Number,\r\n    sourceY: Number,\r\n    sourceWidth: Number,\r\n    sourceHeight: Number,\r\n    blendMode: Number,\r\n    autoResize: Boolean,\r\n    touchEnabled: Boolean,\r\n    mouseEnabled: Boolean,\r\n};\r\nvar TextLabelProperties = {\r\n    ...SpriteProperties,\r\n    text: String,\r\n    fontName: String,\r\n    textAlign: String,\r\n    fontColor: [String, Number],\r\n    fontSize: Number,\r\n    lineHeight: Number,\r\n    fontStyle: String,\r\n    fontWeight: String,\r\n    strokeColor: [String, Number],\r\n    strokeWidth: Number,\r\n    wordWrap: Boolean,\r\n    textFlow: Array,\r\n    autoResizeWidth: Boolean,\r\n};\r\nvar BMFontLabelProperties = {\r\n    ...SpriteProperties,\r\n    textureMap: Object,\r\n    text: String,\r\n    textAlign: String,\r\n    wordWrap: Boolean,\r\n    wordSpace: Number,\r\n    lineHeight: Number,\r\n    fontSize: Number,\r\n    autoResizeHeight: Boolean,\r\n};\r\n// var ScrollViewProperties = {\r\n//     ...SpriteProperties,\r\n//     bounce: Boolean,\r\n//     horizentalScroll: Boolean,\r\n//     verticalScroll: Boolean,\r\n// };\r\n// var AutoLayoutViewProperties = {\r\n//     ...ScrollViewProperties,\r\n//     layout: Number,\r\n//     verticalSpacing: Number,\r\n//     horizentalSpacing: Number,\r\n// };\r\n// var AutoResizeViewProperties = {\r\n//     ...SpriteProperties,\r\n//     layout: Number,\r\n//     marginLeft: Number,\r\n//     marginRight: Number,\r\n//     marginTop: Number,\r\n//     marginBottom: Number,\r\n//     verticalSpacing: Number,\r\n//     horizentalSpacing: Number,\r\n//     alignChild: Number,\r\n// };\r\n\r\nComponentManager.registerBaseComponent(\"sprite\", Sprite);\r\n// ComponentManager.registerBaseComponent(\"text\", TextLabel);\r\n// ComponentManager.registerBaseComponent(\"bmfont\", BMFontLabel);\r\nComponentManager.registerComponentProperties(Sprite, SpriteProperties);\r\nComponentManager.registerComponentProperties(TextLabel, TextLabelProperties);\r\nComponentManager.registerComponentProperties(BMFontLabel, BMFontLabelProperties);\r\n// ComponentManager.registerComponentProperties(ScrollView, ScrollViewProperties);\r\n// ComponentManager.registerComponentProperties(AutoLayoutView, AutoLayoutViewProperties);\r\n// ComponentManager.registerComponentProperties(AutoResizeView, AutoResizeViewProperties);","import { Sprite, SpriteProps, UIEvent, EventHelper } from 'canvas2djs';\r\nimport { TouchScroll } from './TouchScroll';\r\nimport { BaseComponent, Property } from './ComponentManager';\r\nimport \"./InternalViews\";\r\nimport { Utility } from './Utility';\r\n\r\nexport type ScrollViewProps = SpriteProps & {\r\n    bounce?: boolean;\r\n    horizentalScroll?: boolean;\r\n    verticalScroll?: boolean;\r\n    onScroll?(scrollPosition: Point);\r\n};\r\n\r\nexport type Point = { x: number; y: number; }\r\n\r\n@BaseComponent(\"ScrollView\", \"sprite\")\r\nexport class ScrollView extends Sprite<ScrollViewProps> {\r\n\r\n    public static SCROLL = \"scroll\";\r\n    public static scrollThreshold: number = 5;\r\n\r\n    public onScroll: (scrollPosition: Point) => any;\r\n\r\n    @Property(Boolean)\r\n    public horizentalScroll: boolean;\r\n\r\n    @Property(Boolean)\r\n    public verticalScroll: boolean;\r\n\r\n    @Property(Boolean)\r\n    public bounce: boolean;\r\n\r\n    protected scroller: Sprite<{}>;\r\n    protected scrollPos: Point;\r\n    protected size: { width: number, height: number };\r\n    protected touchScrollHorizental: TouchScroll;\r\n    protected touchScrollVertical: TouchScroll;\r\n\r\n    protected beginPosId: number;\r\n    protected beginPos: Point;\r\n\r\n    constructor(props: ScrollViewProps = {}) {\r\n        super({\r\n            ...props,\r\n            clipOverflow: true,\r\n        });\r\n        this.size = { width: 0, height: 0 };\r\n        this.scrollPos = { x: 0, y: 0 };\r\n        this.scroller = new Sprite({\r\n            originX: 0,\r\n            originY: 0,\r\n            percentWidth: 1,\r\n            percentHeight: 1,\r\n        });\r\n        this.scroller.addChild = function (target: Sprite<{}>, position?: number) {\r\n            if (!this.children || this.children.length <= 1) {\r\n                this.visible = false;\r\n            }\r\n            Sprite.prototype.addChild.call(this, target, position);\r\n            // this.parent && this.parent.updateView();\r\n            if (this.parent) {\r\n                Utility.nextTick(this.parent.updateView, this.parent);\r\n            }\r\n        };\r\n        this.scroller.removeChild = function (target: Sprite<{}>) {\r\n            Sprite.prototype.removeChild.call(this, target);\r\n            // this.parent && this.parent.updateView();\r\n            if (this.parent) {\r\n                Utility.nextTick(this.parent.updateView, this.parent);\r\n            }\r\n        };\r\n\r\n        this.bounce = this.bounce == null ? true : this.bounce;\r\n        super.addChild(this.scroller);\r\n        this.touchScrollHorizental = new TouchScroll(this.onUpdateHorizentalScroll, () => { });\r\n        this.touchScrollVertical = new TouchScroll(this.onUpdateVerticalScroll, () => { });\r\n        this.touchScrollHorizental.bounce = this.touchScrollVertical.bounce = this.bounce;\r\n\r\n        this.on(UIEvent.TOUCH_BEGIN, this.onTouchBeginHandler);\r\n        this.on(UIEvent.MOUSE_BEGIN, this.onMouseBeginHandler);\r\n    }\r\n\r\n    public addChild(child: Sprite<{}>, position?: number) {\r\n        this.scroller.addChild(child, position);\r\n        // this.updateView();\r\n    }\r\n\r\n    public removeChild(child: Sprite<{}>) {\r\n        this.scroller.removeChild(child);\r\n        // this.updateView();\r\n    }\r\n\r\n    public removeAllChildren(recusive?: boolean) {\r\n        this.scroller.removeAllChildren(recusive);\r\n    }\r\n\r\n    public getScrollerSize() {\r\n        return { ...this.size };\r\n    }\r\n\r\n    protected _onChildResize() {\r\n        Utility.nextTick(this.notifyResizeParent, this);\r\n    }\r\n\r\n    protected notifyResizeParent() {\r\n        this.updateView();\r\n        if (this.parent) {\r\n            this.parent['_onChildResize']();\r\n        }\r\n    }\r\n\r\n    protected updateView() {\r\n        if (!this.scroller) {\r\n            return;\r\n        }\r\n        let width = 0;\r\n        let height = 0;\r\n        let children = this.scroller.children;\r\n        if (children) {\r\n            for (let i = 0, sprite: Sprite<{}>; sprite = children[i]; i++) {\r\n                let left = sprite.x - (sprite as any)._originPixelX;\r\n                let top = sprite.y - (sprite as any)._originPixelY;\r\n                let right = left + sprite.width;\r\n                let bottom = top + sprite.height;\r\n                if (right > width) {\r\n                    width = right;\r\n                }\r\n                if (bottom > height) {\r\n                    height = bottom;\r\n                }\r\n            }\r\n        }\r\n        if (height - this.height < this.scrollPos.y && this.verticalScroll) {\r\n            Utility.nextTick(this.fixScrollPosition, this);\r\n        }\r\n        if (width - this.width < this.scrollPos.x && this.horizentalScroll) {\r\n            Utility.nextTick(this.fixScrollPosition, this);\r\n        }\r\n        this.size.width = width;\r\n        this.size.height = height;\r\n        this.scroller.visible = true;\r\n        this.updateItemVisible();\r\n    }\r\n\r\n    protected fixScrollPosition() {\r\n        if (!this.size || !this.touchScrollHorizental || !this.touchScrollVertical) {\r\n            return;\r\n        }\r\n        if (this.size.height - this.height < this.scrollPos.y && this.verticalScroll) {\r\n            this.touchScrollVertical.stop();\r\n            this.onUpdateVerticalScroll(Math.max(0, this.size.height - this.height));\r\n        }\r\n        if (this.size.width - this.width < this.scrollPos.x && this.horizentalScroll) {\r\n            this.touchScrollHorizental.stop();\r\n            this.onUpdateHorizentalScroll(Math.max(0, this.size.width - this.width));\r\n        }\r\n    }\r\n\r\n    protected updateItemVisible() {\r\n        let children = this.scroller.children;\r\n        let x = this.scroller.x;\r\n        let y = this.scroller.y;\r\n        let viewportWidth = this.width;\r\n        let viewportHeight = this.height;\r\n        if (children) {\r\n            for (let i = 0, sprite: Sprite<{}>; sprite = children[i]; i++) {\r\n                let left = x + sprite.x - (sprite as any)._originPixelX;\r\n                let top = y + sprite.y - (sprite as any)._originPixelY;\r\n                let right = left + sprite.width;\r\n                let bottom = top + sprite.height;\r\n                if (left >= viewportWidth || right <= 0 || top >= viewportHeight || bottom <= 0) {\r\n                    sprite.visible = false;\r\n                }\r\n                else {\r\n                    sprite.visible = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public setScrollerX(scrollX: number) {\r\n        this.scroller.x = -scrollX;\r\n        this.scrollPos.x = scrollX;\r\n        this.updateItemVisible();\r\n        let pos = {\r\n            x: this.scrollPos.x,\r\n            y: this.scrollPos.y,\r\n        }\r\n        this.onScroll && this.onScroll(pos);\r\n        this.emit(ScrollView.SCROLL, pos);\r\n    }\r\n\r\n    public setScrollerY(scrollY: number) {\r\n        this.scroller.y = -scrollY;\r\n        this.scrollPos.y = scrollY;\r\n        this.updateItemVisible();\r\n        let pos = {\r\n            x: this.scrollPos.x,\r\n            y: this.scrollPos.y,\r\n        }\r\n        this.onScroll && this.onScroll(pos);\r\n        this.emit(ScrollView.SCROLL, pos);\r\n    }\r\n\r\n    protected onUpdateHorizentalScroll = (scrollX: number) => {\r\n        this.setScrollerX(scrollX);\r\n    }\r\n\r\n    protected onUpdateVerticalScroll = (scrollY: number) => {\r\n        this.setScrollerY(scrollY);\r\n    }\r\n\r\n    protected onTouchBeginHandler = (helpers: EventHelper[]) => {\r\n        if (!this.horizentalScroll && !this.verticalScroll) {\r\n            return;\r\n        }\r\n\r\n        let helper = helpers[0];\r\n        this.beginPosId = helper.identifier;\r\n        this.beginPos = { x: helper.stageX, y: helper.stageY };\r\n\r\n        if (this.horizentalScroll) {\r\n            this.touchScrollHorizental.start(helper.stageX);\r\n        }\r\n        if (this.verticalScroll) {\r\n            this.touchScrollVertical.start(helper.stageY);\r\n        }\r\n\r\n        // helper.stopPropagation();\r\n\r\n        if (this.stage) {\r\n            this.stage.on(UIEvent.TOUCH_MOVED, this.onTouchMovedHandler);\r\n            this.stage.on(UIEvent.TOUCH_ENDED, this.onTouchEndedHandler);\r\n        }\r\n    }\r\n\r\n    protected onTouchMovedHandler = (helpers: EventHelper[]) => {\r\n        if (!this.beginPos) {\r\n            return;\r\n        }\r\n\r\n        let touchPoint = helpers.filter(e => e.identifier === this.beginPosId)[0];\r\n        if (!touchPoint) {\r\n            return;\r\n        }\r\n\r\n        let beginPos = this.beginPos;\r\n        if (this.horizentalScroll && Math.abs(touchPoint.stageX - beginPos.x) >= ScrollView.scrollThreshold) {\r\n            this.touchScrollHorizental.update(touchPoint.stageX, this.size.width - this.width, this.scrollPos.x);\r\n        }\r\n        if (this.verticalScroll && Math.abs(touchPoint.stageY - beginPos.y) >= ScrollView.scrollThreshold) {\r\n            this.touchScrollVertical.update(touchPoint.stageY, this.size.height - this.height, this.scrollPos.y);\r\n        }\r\n\r\n        touchPoint.stopPropagation();\r\n    }\r\n\r\n    protected onTouchEndedHandler = (helpers: EventHelper[]) => {\r\n        if (this.stage) {\r\n            this.stage.removeListener(UIEvent.TOUCH_MOVED, this.onTouchMovedHandler);\r\n            this.stage.removeListener(UIEvent.TOUCH_ENDED, this.onTouchEndedHandler);\r\n        }\r\n        if (this.horizentalScroll) {\r\n            this.touchScrollHorizental.finish(this.scrollPos.x, this.size.width - this.width);\r\n        }\r\n        if (this.verticalScroll) {\r\n            this.touchScrollVertical.finish(this.scrollPos.y, this.size.height - this.height);\r\n        }\r\n        if (this.beginPos) {\r\n            let touchPoint = helpers.filter(e => e.identifier === this.beginPosId)[0];\r\n            touchPoint && touchPoint.stopPropagation();\r\n        }\r\n        this.beginPos = this.beginPosId = null;\r\n    }\r\n\r\n    protected onMouseBeginHandler = (helper: EventHelper) => {\r\n        if (!this.horizentalScroll && !this.verticalScroll) {\r\n            return;\r\n        }\r\n\r\n        this.beginPosId = helper.identifier;\r\n        this.beginPos = { x: helper.stageX, y: helper.stageY };\r\n\r\n        if (this.horizentalScroll) {\r\n            this.touchScrollHorizental.start(helper.stageX);\r\n        }\r\n        if (this.verticalScroll) {\r\n            this.touchScrollVertical.start(helper.stageY);\r\n        }\r\n\r\n        // helper.stopPropagation();\r\n\r\n        if (this.stage) {\r\n            this.stage.on(UIEvent.MOUSE_MOVED, this.onMouseMovedHandler);\r\n            this.stage.on(UIEvent.MOUSE_ENDED, this.onMouseEndedHandler);\r\n        }\r\n    }\r\n\r\n    protected onMouseMovedHandler = (helper: EventHelper) => {\r\n        if (!this.beginPos || helper.identifier !== this.beginPosId) {\r\n            return;\r\n        }\r\n\r\n        let beginPos = this.beginPos;\r\n        if (this.horizentalScroll && Math.abs(helper.stageX - beginPos.x) >= ScrollView.scrollThreshold) {\r\n            this.touchScrollHorizental.update(helper.stageX, this.size.width - this.width, this.scrollPos.x);\r\n        }\r\n        if (this.verticalScroll && Math.abs(helper.stageY - beginPos.y) >= ScrollView.scrollThreshold) {\r\n            this.touchScrollVertical.update(helper.stageY, this.size.height - this.height, this.scrollPos.y);\r\n        }\r\n\r\n        helper.stopPropagation();\r\n    }\r\n\r\n    protected onMouseEndedHandler = (helper: EventHelper) => {\r\n        if (this.stage) {\r\n            this.stage.removeListener(UIEvent.MOUSE_MOVED, this.onMouseMovedHandler);\r\n            this.stage.removeListener(UIEvent.MOUSE_ENDED, this.onMouseEndedHandler);\r\n        }\r\n        if (this.horizentalScroll) {\r\n            this.touchScrollHorizental.finish(this.scrollPos.x, this.size.width - this.width);\r\n        }\r\n        if (this.verticalScroll) {\r\n            this.touchScrollVertical.finish(this.scrollPos.y, this.size.height - this.height);\r\n        }\r\n        if (this.beginPos && this.beginPosId === helper.identifier) {\r\n            helper && helper.stopPropagation();\r\n        }\r\n        this.beginPos = this.beginPosId = null;\r\n    }\r\n\r\n    public release(recusive?: boolean) {\r\n        if (this.stage) {\r\n            this.stage.removeListener(UIEvent.TOUCH_MOVED, this.onTouchMovedHandler);\r\n            this.stage.removeListener(UIEvent.TOUCH_ENDED, this.onTouchEndedHandler);\r\n            this.stage.removeListener(UIEvent.MOUSE_MOVED, this.onMouseMovedHandler);\r\n            this.stage.removeListener(UIEvent.MOUSE_ENDED, this.onMouseEndedHandler);\r\n        }\r\n        this.touchScrollHorizental.release();\r\n        this.touchScrollVertical.release();\r\n        this.touchScrollHorizental = this.touchScrollVertical = null;\r\n        this.scroller.removeChild = this.removeChild = Sprite.prototype.removeChild;\r\n        this.removeAllChildren = Sprite.prototype.removeAllChildren;\r\n        // super.removeChild(this.scroller);\r\n        this.scroller.release(true);\r\n        this.scroller = null;\r\n        super.release(recusive);\r\n    }\r\n}","import { ScrollView, ScrollViewProps } from './ScrollView';\r\nimport { Sprite, AlignType, UIEvent } from 'canvas2djs';\r\nimport { BaseComponent, Property } from './ComponentManager';\r\nimport \"./InternalViews\";\r\nimport { Utility } from './Utility';\r\n\r\nexport type AutoLayoutViewProps = ScrollViewProps & {\r\n    layout?: Layout;\r\n    verticalSpacing?: number;\r\n    horizentalSpacing?: number;\r\n    autoSize?: boolean;\r\n    horizentalAlign?: HorizentalAlign;\r\n    verticalAlign?: VerticalAlign;\r\n}\r\n\r\nexport enum Layout {\r\n    Vertical,\r\n    Horizontal,\r\n}\r\n\r\nexport type HorizentalAlign = AlignType.LEFT | AlignType.CENTER | AlignType.RIGHT;\r\nexport type VerticalAlign = AlignType.TOP | AlignType.CENTER | AlignType.BOTTOM\r\n\r\n@BaseComponent(\"AutoLayoutView\", \"ScrollView\")\r\nexport class AutoLayoutView extends ScrollView {\r\n\r\n    protected _props: AutoLayoutViewProps;\r\n    protected _layout: Layout;\r\n    protected _verticalSpacing: number;\r\n    protected _horizentalSpacing: number;\r\n    protected _autoSize: boolean;\r\n    protected _horizentalAlign: HorizentalAlign;\r\n    protected _verticalAlign: VerticalAlign;\r\n\r\n    constructor(props = {}) {\r\n        super({\r\n            ...props,\r\n        });\r\n        this._layout = this._layout == null ? Layout.Horizontal : this._layout;\r\n        this._horizentalAlign = this._horizentalAlign == null ? AlignType.CENTER : this._horizentalAlign;\r\n        this._verticalAlign = this._verticalAlign == null ? AlignType.CENTER : this._verticalAlign;\r\n        this._autoSize = this._autoSize == null ? false : this._autoSize;\r\n        this._verticalSpacing = this._verticalSpacing || 0;\r\n        this._horizentalSpacing = this._horizentalSpacing || 0;\r\n    }\r\n\r\n    @Property(Number)\r\n    get horizentalAlign() {\r\n        return this._horizentalAlign;\r\n    }\r\n\r\n    set horizentalAlign(value: HorizentalAlign) {\r\n        if (value !== this._horizentalAlign) {\r\n            this._horizentalAlign = value;\r\n            // this.updateView();\r\n            Utility.nextTick(this.updateView, this);\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get verticalAlign() {\r\n        return this._verticalAlign;\r\n    }\r\n\r\n    set verticalAlign(value: VerticalAlign) {\r\n        if (value !== this._verticalAlign) {\r\n            this._verticalAlign = value;\r\n            // this.updateView();\r\n            Utility.nextTick(this.updateView, this);\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get layout() {\r\n        return this._layout;\r\n    }\r\n\r\n    set layout(value: Layout) {\r\n        if (value !== this._layout) {\r\n            this._layout = value;\r\n            // this.updateView();\r\n            Utility.nextTick(this.updateView, this);\r\n        }\r\n    }\r\n\r\n    @Property(Boolean)\r\n    get autoSize() {\r\n        return this._autoSize;\r\n    }\r\n\r\n    set autoSize(value: boolean) {\r\n        if (this._autoSize !== value) {\r\n            this._autoSize = value;\r\n            if (value) {\r\n                if (this._layout === Layout.Horizontal) {\r\n                    this.height = this.size.height;\r\n                }\r\n                else if (this._layout === Layout.Vertical) {\r\n                    this.width = this.size.width;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get verticalSpacing() {\r\n        return this._verticalSpacing;\r\n    }\r\n\r\n    set verticalSpacing(value: number) {\r\n        if (value !== this._verticalSpacing) {\r\n            this._verticalSpacing = value;\r\n            // this.updateView();\r\n            Utility.nextTick(this.updateView, this);\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get horizentalSpacing() {\r\n        return this._horizentalSpacing;\r\n    }\r\n\r\n    set horizentalSpacing(value: number) {\r\n        if (value !== this._horizentalSpacing) {\r\n            this._horizentalSpacing = value;\r\n            // this.updateView();\r\n            Utility.nextTick(this.updateView, this);\r\n        }\r\n    }\r\n\r\n    // public addChild(target: Sprite<{}>, position?: number) {\r\n    //     Sprite.prototype.addChild.call(this.scroller, target, position);\r\n    //     this.updateView();\r\n    // }\r\n\r\n    // public removeChild(target: Sprite<{}>) {\r\n    //     Sprite.prototype.removeChild.call(this.scroller, target);\r\n    //     this.updateView();\r\n    // }\r\n\r\n    protected updateView() {\r\n        if (!this.scroller) {\r\n            return;\r\n        }\r\n        if (!this.scroller.children || !this.scroller.children.length) {\r\n            this.size = { width: 0, height: 0 };\r\n            if (this._autoSize) {\r\n                if (this._layout === Layout.Horizontal) {\r\n                    this.height = 0;\r\n                }\r\n                else if (this._layout === Layout.Vertical) {\r\n                    this.width = 0;\r\n                }\r\n            }\r\n            if (this.verticalScroll) {\r\n                this.touchScrollVertical.stop();\r\n            }\r\n            if (this.horizentalScroll) {\r\n                this.touchScrollHorizental.stop();\r\n            }\r\n            return;\r\n        }\r\n\r\n        let children = this.scroller.children;\r\n        let { width, height, verticalSpacing, horizentalSpacing } = this;\r\n        let maxHeight = 0;\r\n        let maxWidth = 0;\r\n        let x = 0;\r\n        let y = 0;\r\n        let beginIndex = 0;\r\n        let count = 0;\r\n        let prevExist: boolean;\r\n\r\n        if (this.layout === Layout.Horizontal) {\r\n            let list: Sprite<{}>[] = [];\r\n            for (let index = 0, sprite: Sprite<{}>; sprite = children[index]; index++) {\r\n                // sprite.left = null;\r\n                if (sprite.width === 0) {\r\n                    continue;\r\n                }\r\n                let spacing = (prevExist ? horizentalSpacing : 0);\r\n                let right = x + sprite.width + spacing;\r\n                if (right <= width || index === 0) {\r\n                    // sprite.x = x + (sprite as any)._originPixelX + spacing;\r\n                    list.push(sprite);\r\n                    x = right;\r\n                    prevExist = true;\r\n                }\r\n                else {\r\n                    this.applyHorizentalAlign(list, x);\r\n                    y += count > 0 ? verticalSpacing : 0;\r\n                    this.alignChildHorizental(beginIndex, index - 1, children, y, maxHeight);\r\n                    beginIndex = index;\r\n                    y += maxHeight;\r\n                    x = sprite.width;\r\n                    // sprite.x = (sprite as any)._originPixelX;\r\n                    list = [sprite];\r\n                    maxHeight = 0;\r\n                    count += 1;\r\n                }\r\n                if (sprite.height > maxHeight) {\r\n                    maxHeight = sprite.height;\r\n                }\r\n            }\r\n\r\n            this.applyHorizentalAlign(list, x);\r\n            y += count > 0 ? verticalSpacing : 0;\r\n            this.alignChildHorizental(beginIndex, children.length - 1, children, y, maxHeight);\r\n        }\r\n        else if (this.layout === Layout.Vertical) {\r\n            let list: Sprite<{}>[] = [];\r\n            for (let index = 0, sprite: Sprite<{}>; sprite = children[index]; index++) {\r\n                if (sprite.height === 0) {\r\n                    continue;\r\n                }\r\n                let spacing = (prevExist ? verticalSpacing : 0);\r\n                let bottom = y + sprite.height;\r\n                if (bottom <= height || index === 0) {\r\n                    // sprite.y = y + (sprite as any)._originPixelY + spacing;\r\n                    list.push(sprite);\r\n                    y = bottom;\r\n                    prevExist = true;\r\n                }\r\n                else {\r\n                    this.applayVerticalAlign(list, y);\r\n                    x += count > 0 ? horizentalSpacing : 0;\r\n                    this.alignChildVirtical(beginIndex, index - 1, children, x, maxWidth);\r\n                    beginIndex = index;\r\n                    x += maxWidth;\r\n                    y = sprite.height;\r\n                    // sprite.y = (sprite as any)._originPixelY;\r\n                    list = [sprite];\r\n                    maxWidth = 0;\r\n                    count += 1;\r\n                }\r\n                if (sprite.width > maxWidth) {\r\n                    maxWidth = sprite.width;\r\n                }\r\n            }\r\n\r\n            this.applayVerticalAlign(list, y);\r\n            x += count > 0 ? horizentalSpacing : 0;\r\n            this.alignChildVirtical(beginIndex, children.length - 1, children, x, maxWidth);\r\n        }\r\n        else {\r\n            Utility.warn(`Unknow layout`, this.layout);\r\n        }\r\n\r\n        super.updateView();\r\n        if (this._autoSize) {\r\n            if (this._layout === Layout.Horizontal) {\r\n                this.height = this.size.height;\r\n            }\r\n            else if (this._layout === Layout.Vertical) {\r\n                this.width = this.size.width;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected applyHorizentalAlign(sprites: Sprite<{}>[], totalWidth: number) {\r\n        let horizentalSpacing = this._horizentalSpacing;\r\n        let startX = 0;\r\n        if (this._horizentalAlign === AlignType.CENTER) {\r\n            startX = (this.width - totalWidth) * 0.5;\r\n        }\r\n        else if (this._horizentalAlign === AlignType.RIGHT) {\r\n            startX = this.width - totalWidth;\r\n        }\r\n        for (let i = 0, sprite: Sprite<{}>; sprite = sprites[i]; i++) {\r\n            let spacing = (i > 0 ? horizentalSpacing : 0);\r\n            sprite.x = startX + (<any>sprite)._originPixelX + spacing;\r\n            startX += sprite.width + spacing;\r\n        }\r\n    }\r\n\r\n    protected applayVerticalAlign(sprites: Sprite<{}>[], totalHeight: number) {\r\n        let verticalSpacing = this._verticalSpacing;\r\n        let startY = 0;\r\n        if (this._verticalAlign === AlignType.CENTER) {\r\n            startY = (this.height - totalHeight) * 0.5;\r\n        }\r\n        else if (this._verticalAlign === AlignType.BOTTOM) {\r\n            startY = this.height - totalHeight;\r\n        }\r\n        for (let i = 0, sprite: Sprite<{}>; sprite = sprites[i]; i++) {\r\n            let spacing = (i > 0 ? verticalSpacing : 0);\r\n            sprite.y = startY + (<any>sprite)._originPixelY + spacing;\r\n            startY += sprite.height + spacing;\r\n        }\r\n    }\r\n\r\n    protected alignChildVirtical(begin: number, end: number, sprites: Sprite<{}>[], x: number, width: number) {\r\n        if (end < begin) {\r\n            return;\r\n        }\r\n        let align = this._horizentalAlign;\r\n        if (align === AlignType.LEFT) {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.x = x + sprite._originPixelX;\r\n            }\r\n        }\r\n        else if (align === AlignType.RIGHT) {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.x = x + width - sprite.width + sprite._originPixelX;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.x = x + (width - sprite.width) * 0.5 + sprite._originPixelX;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected alignChildHorizental(begin: number, end: number, sprites: Sprite<{}>[], y: number, height: number) {\r\n        if (end < begin) {\r\n            return;\r\n        }\r\n        let align = this._verticalAlign;\r\n        if (align === AlignType.TOP) {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.y = y + sprite._originPixelY;\r\n            }\r\n        }\r\n        else if (align === AlignType.BOTTOM) {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.y = y + height - sprite.height + sprite._originPixelY;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = begin; i <= end; i++) {\r\n                let sprite = sprites[i] as any;\r\n                sprite.y = y + (height - sprite.height) * 0.5 + sprite._originPixelY;\r\n            }\r\n        }\r\n    }\r\n}","import { Sprite, SpriteProps, AlignType, Action, ReleasePool } from 'canvas2djs';\r\nimport { Layout } from './AutoLayoutView';\r\nimport { BaseComponent, Property } from './ComponentManager';\r\nimport \"./InternalViews\";\r\n\r\nexport type AutoResizeViewProps = SpriteProps & {\r\n    layout?: Layout;\r\n    alignChild?: AlignType;\r\n    marginLeft?: number;\r\n    marginTop?: number;\r\n    marginRight?: number;\r\n    marginBottom?: number;\r\n    verticalSpacing?: number;\r\n    horizentalSpacing?: number;\r\n}\r\n\r\n@BaseComponent(\"AutoResizeView\", \"sprite\")\r\nexport class AutoResizeView extends Sprite<AutoResizeViewProps> {\r\n\r\n    protected _layout: Layout;\r\n    protected _alignChild: AlignType;\r\n    protected _marginLeft: number;\r\n    protected _marginTop: number;\r\n    protected _marginRight: number;\r\n    protected _marginBottom: number;\r\n    protected _verticalSpacing: number;\r\n    protected _horizentalSpacing: number;\r\n\r\n    constructor(props = {}) {\r\n        super({\r\n            ...props\r\n        });\r\n        this._marginTop = this._marginTop || 0;\r\n        this._marginRight = this._marginRight || 0;\r\n        this._marginBottom = this._marginBottom || 0;\r\n        this._marginLeft = this._marginLeft || 0;\r\n        this._verticalSpacing = this._verticalSpacing || 0;\r\n        this._horizentalSpacing = this._horizentalSpacing || 0;\r\n        this._layout = this._layout == null ? Layout.Horizontal : this._layout;\r\n        this._alignChild = this._alignChild == null ? AlignType.CENTER : this._alignChild;\r\n    }\r\n\r\n    @Property(Number)\r\n    get marginLeft() {\r\n        return this._marginLeft;\r\n    }\r\n\r\n    set marginLeft(value: number) {\r\n        if (value !== this._marginLeft) {\r\n            this._marginLeft = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get marginRight() {\r\n        return this._marginRight;\r\n    }\r\n\r\n    set marginRight(value: number) {\r\n        if (value !== this._marginRight) {\r\n            this._marginRight = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get marginBottom() {\r\n        return this._marginBottom;\r\n    }\r\n\r\n    set marginBottom(value: number) {\r\n        if (value !== this._marginBottom) {\r\n            this._marginBottom = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get marginTop() {\r\n        return this._marginTop;\r\n    }\r\n\r\n    set marginTop(value: number) {\r\n        if (value !== this._marginTop) {\r\n            this._marginTop = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get verticalSpacing() {\r\n        return this._verticalSpacing;\r\n    }\r\n\r\n    set verticalSpacing(value: number) {\r\n        if (value !== this._verticalSpacing) {\r\n            this._verticalSpacing = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get horizentalSpacing() {\r\n        return this._horizentalSpacing;\r\n    }\r\n\r\n    set horizentalSpacing(value: number) {\r\n        if (value !== this._horizentalSpacing) {\r\n            this._horizentalSpacing = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get layout() {\r\n        return this._layout;\r\n    }\r\n\r\n    set layout(value: Layout) {\r\n        if (value !== this._layout) {\r\n            this._layout = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    @Property(Number)\r\n    get alignChild() {\r\n        return this._alignChild;\r\n    }\r\n\r\n    set alignChild(value: AlignType) {\r\n        if (value !== this._alignChild) {\r\n            this._alignChild = value;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    public addChild(target: Sprite<{}>, position?: number) {\r\n        super.addChild(target, position);\r\n        this.updateView();\r\n    }\r\n\r\n    public removeChild(target: Sprite<{}>) {\r\n        super.removeChild(target);\r\n        this.updateView();\r\n    }\r\n\r\n    protected _onChildResize() {\r\n        this.updateView();\r\n        super._onChildResize();\r\n    }\r\n\r\n    protected updateView() {\r\n        if (!this.children || !this.children.length) {\r\n            this.width = 0;\r\n            this.height = 0;\r\n            return;\r\n        }\r\n\r\n        const { layout, alignChild, children, marginLeft, marginRight, marginBottom, marginTop, verticalSpacing, horizentalSpacing } = this;\r\n        let height: number;\r\n        let width: number;\r\n        let count = 0;\r\n\r\n        if (layout === Layout.Horizontal) {\r\n            width = marginLeft;\r\n            height = 0;\r\n            for (let index = 0, sprite: Sprite<{}>; sprite = children[index]; index++) {\r\n                if (sprite.width === 0 || !sprite.visible) {\r\n                    continue;\r\n                }\r\n                if (sprite.height > height) {\r\n                    height = sprite.height;\r\n                }\r\n                let spacing = count > 0 ? horizentalSpacing : 0;\r\n                sprite.x = width + (<any>sprite)._originPixelX + spacing;\r\n                width += sprite.width + spacing;\r\n                count += 1;\r\n            }\r\n\r\n            if (width > marginLeft) {\r\n                this.width = width + marginRight;\r\n            }\r\n            else {\r\n                this.width = 0;\r\n            }\r\n            if (height != 0) {\r\n                if (alignChild === AlignType.TOP) {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.y = marginTop + (<any>sprite)._originPixelY;\r\n                    }\r\n                }\r\n                else if (alignChild === AlignType.BOTTOM) {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.y = marginTop + height - sprite.height + (<any>sprite)._originPixelY;\r\n                    }\r\n                }\r\n                else {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.y = marginTop + (height - sprite.height) * 0.5 + (<any>sprite)._originPixelY;\r\n                    }\r\n                }\r\n                height += marginTop + marginBottom;\r\n                this.height = height;\r\n            }\r\n            else {\r\n                this.height = 0;\r\n            }\r\n        }\r\n        else if (layout === Layout.Vertical) {\r\n            width = 0;\r\n            height = marginTop;\r\n            for (let index = 0, sprite: Sprite<{}>; sprite = children[index]; index++) {\r\n                if (sprite.height === 0 || !sprite.visible) {\r\n                    continue;\r\n                }\r\n                if (sprite.width > width) {\r\n                    width = sprite.width;\r\n                }\r\n                let spacing = count > 0 ? verticalSpacing : 0;\r\n                sprite.y = height + (<any>sprite)._originPixelY + spacing;\r\n                height += sprite.height + spacing;\r\n                count += 1;\r\n            }\r\n\r\n            if (height > marginTop) {\r\n                this.height = height + marginBottom;\r\n            }\r\n            else {\r\n                this.height = 0;\r\n            }\r\n            if (width != 0) {\r\n                if (alignChild === AlignType.LEFT) {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.x = marginLeft + (<any>sprite)._originPixelX;\r\n                    }\r\n                }\r\n                else if (alignChild === AlignType.RIGHT) {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.x = marginLeft + width - sprite.width + (<any>sprite)._originPixelX;\r\n                    }\r\n                }\r\n                else {\r\n                    for (let i = 0, sprite: Sprite<{}>; sprite = this.children[i]; i++) {\r\n                        sprite.x = marginLeft + (width - sprite.width) * 0.5 + (<any>sprite)._originPixelX;\r\n                    }\r\n                }\r\n                width += marginLeft + marginRight;\r\n                this.width = width;\r\n            }\r\n            else {\r\n                this.width = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    release(recusive?: boolean) {\r\n        Action.stop(this);\r\n\r\n        if (recusive && this.children) {\r\n            while (this.children.length) {\r\n                this.children[0].release(recusive);\r\n            }\r\n        }\r\n        else if (this.children && this.children.length) {\r\n            while (this.children.length) {\r\n                super.removeChild(this.children[0]);\r\n            }\r\n        }\r\n\r\n        if (this.parent) {\r\n            this.parent.removeChild(this);\r\n        }\r\n\r\n        ReleasePool.instance.add(this);\r\n        this.removeAllListeners();\r\n    }\r\n}","import { Utility } from './Utility';\r\n\r\nexport class WeakRef {\r\n\r\n    private static weakRefTable: { [uid: string]: { [ref: string]: any } } = {};\r\n\r\n    public static set(ref: string, source: any, target: any) {\r\n        let uid = Utility.getUid(source);\r\n        if (!this.weakRefTable[uid]) {\r\n            this.weakRefTable[uid] = {};\r\n        }\r\n        if (this.weakRefTable[uid][ref] != null) {\r\n            Utility.warn(`Reference \"${ref}\" target is override`, target, \"Source:\", source);\r\n        }\r\n        this.weakRefTable[uid][ref] = target;\r\n    }\r\n\r\n    public static get(ref: string, source: any) {\r\n        let uid = Utility.getUid(source);\r\n        return this.weakRefTable[uid] && this.weakRefTable[uid][ref];\r\n    }\r\n\r\n    public static remove(ref: string, source: any) {\r\n        let uid = Utility.getUid(source);\r\n        let table = this.weakRefTable[uid];\r\n        if (table) {\r\n            delete table[ref];\r\n            if (Object.keys(table).length === 0) {\r\n                delete this.weakRefTable[uid];\r\n            }\r\n        }\r\n    }\r\n\r\n    public static clear(source: any) {\r\n        delete this.weakRefTable[Utility.getUid(source)];\r\n    }\r\n}","import { Sprite } from 'canvas2djs';\r\nimport { Directive, IDirective, BindingManager } from './BindingManager';\r\nimport { IComponent, ComponentManager, Component } from './ComponentManager';\r\nimport { WatcherManager } from './WatcherManager';\r\nimport { VirtualView, ViewManager } from './ViewManager';\r\nimport { WeakRef } from './WeakRef';\r\nimport { Utility } from './Utility';\r\nimport { TemplateManager } from './TemplateManager';\r\n// import { Parser } from './Parser';\r\nimport { ExpParser } from './ExpParser';\r\n\r\nconst regParam = /\\s+in\\s+/;\r\nconst regComma = /\\s*,\\s*/;\r\nconst regTrackby = /trackby\\s+(\\w+)/;\r\n\r\n@Directive(\":include\")\r\nclass IncludeDirective {\r\n\r\n    view: VirtualView;\r\n    component: IComponent;\r\n    directives: IDirective[];\r\n    currSprite: Sprite<{}>;\r\n    parentSprite: Sprite<{}>;\r\n\r\n    onInit(templateName: string, component: IComponent, view: VirtualView, context) {\r\n        this.view = view;\r\n        this.component = component;\r\n        this.parentSprite = view.sprite.parent;\r\n\r\n        let node = TemplateManager.getTemplateByName(templateName);\r\n        if (node == null) {\r\n            return Utility.warn(`Error updating directive ':include=\"${templateName}\", template \"${templateName}\" not found.'`);\r\n        }\r\n        let newView = ViewManager.createView(node);\r\n\r\n        this.parentSprite.replaceChild(view.sprite, newView.sprite);\r\n        this.directives = BindingManager.createBinding(this.component, newView);\r\n        this.currSprite = newView.sprite;\r\n    }\r\n\r\n    removeTemplate() {\r\n        if (this.directives) {\r\n            for (let i = 0, directive: IDirective; directive = this.directives[i]; i++) {\r\n                BindingManager.removeDirective(this.component, directive);\r\n            }\r\n            this.parentSprite.replaceChild(this.currSprite, this.view.sprite);\r\n            this.currSprite.release(true);\r\n            this.directives = this.currSprite = null;\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeTemplate();\r\n        this.view = this.component = null;\r\n    }\r\n}\r\n\r\n@Directive(\":if\", true, 200)\r\nclass ConditionDirective {\r\n\r\n    view: VirtualView;\r\n    unWatch: Function;\r\n    component: IComponent;\r\n    parentSprite: Sprite<{}>;\r\n    currSprite: Sprite<{}>;\r\n    directives: IDirective[];\r\n\r\n    onInit(expression: string, component: IComponent, view: VirtualView, context) {\r\n        this.view = view;\r\n        this.component = component;\r\n        this.parentSprite = view.sprite.parent;\r\n        this.unWatch = WatcherManager.watch(component, expression, (newValue) => {\r\n            this.onUpdate(!!newValue);\r\n        }, true, true);\r\n    }\r\n\r\n    onUpdate(newValue: boolean) {\r\n        if (newValue && !this.directives) {\r\n            let newView = ViewManager.createView(this.view.node);\r\n            this.parentSprite.replaceChild(this.view.sprite, newView.sprite);\r\n            this.currSprite = newView.sprite;\r\n            this.directives = BindingManager.createBinding(this.component, newView);\r\n        }\r\n        else if (!newValue) {\r\n            this.removeBinding();\r\n        }\r\n    }\r\n\r\n    removeBinding() {\r\n        if (this.directives) {\r\n            let index = this.parentSprite.children.indexOf(this.currSprite);\r\n            for (let i = 0, directive: IDirective; directive = this.directives[i]; i++) {\r\n                BindingManager.removeDirective(this.component, directive);\r\n            }\r\n            // this.parentSprite.replaceChild(this.currSprite, this.view.sprite);\r\n            this.parentSprite.addChild(this.view.sprite, index);\r\n            this.currSprite.release(true);\r\n            this.currSprite = this.directives = null;\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeBinding();\r\n        this.unWatch();\r\n        this.component = this.view = this.unWatch = this.parentSprite = null;\r\n    }\r\n}\r\n\r\n@Directive(\":slot-to\")\r\nclass SlotToDirective implements IDirective {\r\n\r\n    onInit(name: string, component: IComponent, view: VirtualView, context) {\r\n        if (!context.slotViews) {\r\n            context.slotViews = {};\r\n        }\r\n        if (!context.slotViews[name]) {\r\n            context.slotViews[name] = [];\r\n        }\r\n        context.slotViews[name].push(view);\r\n    }\r\n}\r\n\r\n@Directive(\":slot\")\r\nclass SlotPlaceholderDirective implements IDirective {\r\n\r\n    slotSprites: Sprite<{}>[];\r\n\r\n    onInit(name: string, component: IComponent, view: VirtualView, context) {\r\n\r\n        if (!(view.instance instanceof Sprite)) {\r\n            return Utility.error(`Component could not use the slot=\"${name}\" directive.`, view);\r\n        }\r\n        if (!context.slotViews || !context.slotViews[name]) {\r\n            return;\r\n        }\r\n\r\n        let slotViews: VirtualView[] = context.slotViews[name];\r\n        let placeholder: Sprite<{}> = view.instance;\r\n        let slotSprites = this.slotSprites = slotViews.map(v => v.sprite);\r\n\r\n        placeholder.parent.replaceChild(placeholder, ...slotSprites);\r\n    }\r\n\r\n    onDestroy() {\r\n        if (this.slotSprites) {\r\n            for (let i = 0, sprite: Sprite<{}>; sprite = this.slotSprites[i]; i++) {\r\n                // sprite.parent && sprite.parent.removeChild(sprite);\r\n                sprite.release(true);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Directive(\":ref\")\r\nclass ReferenceByKeyDirective implements IDirective {\r\n\r\n    refName: string;\r\n    component: IComponent;\r\n\r\n    onInit(refName: string, component: IComponent, view: VirtualView, context) {\r\n        this.refName = refName;\r\n        this.component = component;\r\n        WeakRef.set(refName, component, view.instance);\r\n    }\r\n\r\n    onDestroy() {\r\n        WeakRef.remove(this.refName, this.component);\r\n        this.refName = this.component = null;\r\n    }\r\n}\r\n\r\n@Directive(\"@ref\")\r\nclass ReferenceByCallbackDirective implements IDirective {\r\n\r\n    onInit(refExp: string, component: IComponent, view: VirtualView, context) {\r\n        let func = ExpParser.parseNormalExp(refExp);\r\n        func.call(component, null, view.instance, window);\r\n    }\r\n}\r\n\r\n/**\r\n * :for=\"item in list trackby id\"\r\n */\r\n@Directive(\":for\", true, 100)\r\nclass ForLoopDirective implements IDirective {\r\n\r\n    private static itemComponentCtors: { [expression: string]: Function } = {};\r\n\r\n    refKey: string;\r\n    originalExp: string;\r\n    expression: string;\r\n    view: VirtualView;\r\n    component: IComponent;\r\n    keyValueName: { key: string; value: string };\r\n    itemDatas: ItemDataDescriptor[];\r\n    itemComponents: IItemComponent[];\r\n    itemComponentCtor: Function;\r\n    unWatch: Function;\r\n    trackByKey: boolean;\r\n    trackKey: string;\r\n\r\n    onInit(expression: string, component: IComponent, view: VirtualView, context) {\r\n        this.refKey = `component:${Utility.getUid(this)}`;\r\n        this.view = view;\r\n        this.component = component;\r\n        this.itemDatas = [];\r\n        this.originalExp = expression;\r\n        this.parseExpression(expression);\r\n        this.unWatch = WatcherManager.watch(component, this.expression, (newValue, oldValue) => {\r\n            this.onUpdate(newValue, oldValue);\r\n        }, true, true);\r\n    }\r\n\r\n    onUpdate(newValue, oldValue) {\r\n        let itemDatas = this.itemDatas = this.toList(newValue);\r\n        let notAnyItems = !this.itemComponents || this.itemComponents.length === 0;\r\n        let newItemComponents: IItemComponent[] = [];\r\n\r\n        for (let index = 0, l = itemDatas.length; index < l; index++) {\r\n            let item = itemDatas[index];\r\n            let itemComponent = newItemComponents[index] = this.getItemComponentByItem(item);\r\n            itemComponent.__idle__ = false;\r\n        }\r\n\r\n        if (!notAnyItems) {\r\n            this.removeItemComponents();\r\n        }\r\n\r\n        for (let i = 0, itemVm: IItemComponent; itemVm = newItemComponents[i]; i++) {\r\n            itemVm.__idle__ = true;\r\n        }\r\n        this.itemComponents = newItemComponents;\r\n\r\n        if (this.itemComponents.length) {\r\n            let parent = this.view.sprite.parent;\r\n            let sprites = this.itemComponents.map((component, i) => {\r\n                let sprite = WeakRef.get(this.refKey, component);\r\n                parent.removeChild(sprite);\r\n                return sprite;\r\n            });\r\n            let index = parent.children.indexOf(this.view.sprite);\r\n            for (let i = 0, sprite: Sprite<{}>; sprite = sprites[i]; i++) {\r\n                parent.addChild(sprite, index++);\r\n            }\r\n            // for (let i = 0, component: IItemComponent; component = this.itemComponents[i]; i++) {\r\n            //     let sprite = WeakRef.get(this.refKey, component);\r\n            //     parent.removeChild(sprite);\r\n            //     parent.addChild(sprite, index++);\r\n            // }\r\n        }\r\n    }\r\n\r\n    getItemComponentByItem(item: ItemDataDescriptor): IItemComponent {\r\n        let value = item.value;\r\n        let itemComponent: IItemComponent;\r\n\r\n        if (this.trackByKey) {\r\n            if (this.itemComponents) {\r\n                let trackValue = value[this.trackKey];\r\n                for (let i = 0; itemComponent = this.itemComponents[i]; i++) {\r\n                    if (itemComponent[this.keyValueName.value][this.trackKey] === trackValue) {\r\n                        if (!itemComponent.__idle__) {\r\n                            Utility.warn(`\"${this.trackKey}\" is not an unique key in directive ':for=\"${this.originalExp}\"'`);\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            let components = WeakRef.get(this.refKey, value);\r\n            if (components) {\r\n                for (let i = 0; itemComponent = components[i]; i++) {\r\n                    if (itemComponent.__idle__) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (itemComponent) {\r\n            this.updateItemComponent(itemComponent, item);\r\n        }\r\n        else {\r\n            itemComponent = this.createItemComponent(item);\r\n            let view = ViewManager.createView(this.view.node);\r\n            let parent = this.view.sprite.parent;\r\n            let index = Math.max(0, parent.children.indexOf(this.view.sprite)) - (this.itemComponents ? this.itemComponents.length : 0) + item.index;\r\n            parent.addChild(view.sprite, index);\r\n            BindingManager.createBinding(itemComponent, view);\r\n            WeakRef.set(this.refKey, itemComponent, view.sprite);\r\n        }\r\n\r\n        return itemComponent;\r\n    }\r\n\r\n    updateItemComponent(component: IItemComponent, item: ItemDataDescriptor) {\r\n        let { key, value } = this.keyValueName;\r\n\r\n        component.$index = item.index;\r\n        component.$isOdd = 0 === item.index % 2;\r\n        component.$isEven = !component.$isOdd;\r\n        component.$isLast = item.index === this.itemDatas.length - 1;\r\n        component.$isFirst = 0 === item.index;\r\n\r\n        if (key != null) {\r\n            component[key] = item.key;\r\n        }\r\n        component[value] = item.value;\r\n    }\r\n\r\n    createItemComponent(item: ItemDataDescriptor): IItemComponent {\r\n        let value = item.value;\r\n        let itemComponent: IItemComponent = ComponentManager.createComponentByConstructor(this.itemComponentCtor);\r\n\r\n        if (!this.trackByKey) {\r\n            let itemComponents: IItemComponent[] = WeakRef.get(this.refKey, value);\r\n            if (itemComponents == null) {\r\n                itemComponents = [];\r\n                WeakRef.set(this.refKey, value, itemComponents);\r\n            }\r\n            itemComponents.push(itemComponent);\r\n        }\r\n\r\n        itemComponent.$parent = this.component;\r\n        this.updateItemComponent(itemComponent, item);\r\n        return itemComponent;\r\n    }\r\n\r\n    removeItemComponents(forceRemove?: boolean) {\r\n        for (let i = 0, itemComponent: IItemComponent; itemComponent = this.itemComponents[i]; i++) {\r\n            if (itemComponent.__idle__ || forceRemove) {\r\n                let value = itemComponent[this.keyValueName.value];\r\n                let sprite: Sprite<{}> = WeakRef.get(this.refKey, itemComponent);\r\n\r\n                itemComponent.$parent = null;\r\n                ComponentManager.destroyComponent(itemComponent);\r\n                sprite.release(true);\r\n\r\n                if (!this.trackByKey) {\r\n                    let components = WeakRef.get(this.refKey, value);\r\n                    WeakRef.remove(this.refKey, itemComponent);\r\n\r\n                    Utility.removeItemFromArray(itemComponent, components);\r\n                    if (!components.length) {\r\n                        WeakRef.remove(this.refKey, value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    parseExpression(expression: string) {\r\n        let parts = expression.split(regParam);\r\n\r\n        if (parts.length !== 2) {\r\n            return Utility.error(`Invalid directive syntax ':for=\"${expression}\"'.`);\r\n        }\r\n\r\n        let key: string;\r\n        let value: string;\r\n        let params: any = parts[0];\r\n\r\n        if (params.indexOf(',') > 0) {\r\n            params = params.split(regComma);\r\n            if (params[0] === '') {\r\n                return Utility.error(`Invalid directive syntax ':for=\"${expression}\"'.`);\r\n            }\r\n            key = params[1];\r\n            value = params[0];\r\n        }\r\n        else {\r\n            value = params;\r\n        }\r\n\r\n        if (!ForLoopDirective.itemComponentCtors[expression]) {\r\n            let ctor = function () { };\r\n            let properties = {\r\n                $index: Number,\r\n                $isFirst: Boolean,\r\n                $isLast: Boolean,\r\n                $isOdd: Boolean,\r\n                $isEven: Boolean,\r\n            };\r\n            properties[value] = null;\r\n            if (key) {\r\n                properties[key] = null;\r\n            }\r\n            ForLoopDirective.itemComponentCtors[expression] = ctor;\r\n            ComponentManager.registerComponentProperties(ctor, properties);\r\n        }\r\n\r\n\r\n        let trackby = parts[1].match(regTrackby);\r\n        if (trackby) {\r\n            this.trackByKey = true;\r\n            this.trackKey = trackby[1];\r\n        }\r\n\r\n        this.keyValueName = { key, value };\r\n        this.expression = parts[1].replace(regTrackby, '').trim();\r\n        this.itemComponentCtor = ForLoopDirective.itemComponentCtors[expression];\r\n    }\r\n\r\n    toList(target: any): ItemDataDescriptor[] {\r\n        let list: ItemDataDescriptor[] = [];\r\n\r\n        if (Array.isArray(target)) {\r\n            for (let idx = 0, l = target.length; idx < l; idx++) {\r\n                let val = target[idx];\r\n                list.push({\r\n                    key: idx,\r\n                    index: idx,\r\n                    value: val\r\n                });\r\n            }\r\n        }\r\n        else if (Utility.isPlainObjectOrObservableObject(target)) {\r\n            let idx = 0;\r\n            let key;\r\n\r\n            for (key in target) {\r\n                list.push({\r\n                    key: key,\r\n                    index: idx++,\r\n                    value: target[key]\r\n                });\r\n            }\r\n        }\r\n        else if (typeof target === 'number') {\r\n            for (let i = 0; i < target; i++) {\r\n                list.push({\r\n                    key: i,\r\n                    index: i,\r\n                    value: i\r\n                });\r\n            }\r\n        }\r\n\r\n        return list;\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeItemComponents(true);\r\n        this.unWatch();\r\n        this.component = this.unWatch = this.view = this.itemComponentCtor = this.itemComponents = this.itemDatas = null;\r\n    }\r\n}\r\n\r\ninterface IItemComponent extends IComponent {\r\n    __idle__: boolean;\r\n    $parent: IComponent;\r\n    $index: number;\r\n    $isOdd: boolean;\r\n    $isEven: boolean;\r\n    $isLast: boolean;\r\n    $isFirst: boolean;\r\n}\r\n\r\ntype ItemDataDescriptor = {\r\n    key: string | number;\r\n    index: number;\r\n    value: any;\r\n}"],"names":["tslib_1.__extends","EventEmitter","Sprite","TextLabel","BMFontLabel","Action","ResourceType","Texture","Sound","Stage","UIEvent","tslib_1.__decorate","Layout","AlignType","ReleasePool"],"mappings":"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"}